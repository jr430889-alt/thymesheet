<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ThymeSheet</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --deep-green: #1C5A3F;
            --eggplant: #4B2E39;
            --off-white: #F9F8F7;
            --soft-gray: #EAEAEA;
            --pearl: #F5F3F0;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: var(--off-white);
            margin: 0;
            padding: 0;
            color: #2D2D2D;
            line-height: 1.6;
        }

        * {
            box-sizing: border-box;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'deep-green': '#1C5A3F',
                        'eggplant': '#4B2E39',
                        'off-white': '#F9F8F7',
                        'soft-gray': '#EAEAEA',
                        'pearl': '#F5F3F0',
                    },
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', 'sans-serif'],
                    },
                    borderRadius: {
                        'subtle': '5px',
                    }
                }
            }
        }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Lucide-style icons using SVG
        const Clock = () => React.createElement('svg', {
            width: '20',
            height: '20',
            viewBox: '0 0 24 24',
            fill: 'none',
            stroke: 'currentColor',
            strokeWidth: '2',
            strokeLinecap: 'round',
            strokeLinejoin: 'round',
            style: { display: 'inline-block', verticalAlign: 'middle' }
        }, React.createElement('circle', { cx: '12', cy: '12', r: '10' }), React.createElement('polyline', { points: '12 6 12 12 16 14' }));

        const Square = () => React.createElement('svg', {
            width: '20',
            height: '20',
            viewBox: '0 0 24 24',
            fill: 'none',
            stroke: 'currentColor',
            strokeWidth: '2',
            strokeLinecap: 'round',
            strokeLinejoin: 'round'
        }, React.createElement('rect', { x: '3', y: '3', width: '18', height: '18', rx: '2', ry: '2' }));

        const Download = () => React.createElement('svg', {
            width: '20',
            height: '20',
            viewBox: '0 0 24 24',
            fill: 'none',
            stroke: 'currentColor',
            strokeWidth: '2',
            strokeLinecap: 'round',
            strokeLinejoin: 'round'
        }, React.createElement('path', { d: 'M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4' }), React.createElement('polyline', { points: '7 10 12 15 17 10' }), React.createElement('line', { x1: '12', y1: '15', x2: '12', y2: '3' }));

        const Upload = () => React.createElement('svg', {
            width: '20',
            height: '20',
            viewBox: '0 0 24 24',
            fill: 'none',
            stroke: 'currentColor',
            strokeWidth: '2',
            strokeLinecap: 'round',
            strokeLinejoin: 'round'
        }, React.createElement('path', { d: 'M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4' }), React.createElement('polyline', { points: '17 8 12 3 7 8' }), React.createElement('line', { x1: '12', y1: '3', x2: '12', y2: '15' }));

        const Plus = () => React.createElement('svg', {
            width: '20',
            height: '20',
            viewBox: '0 0 24 24',
            fill: 'none',
            stroke: 'currentColor',
            strokeWidth: '2',
            strokeLinecap: 'round',
            strokeLinejoin: 'round'
        }, React.createElement('line', { x1: '12', y1: '5', x2: '12', y2: '19' }), React.createElement('line', { x1: '5', y1: '12', x2: '19', y2: '12' }));

        const Trash2 = () => React.createElement('svg', {
            width: '20',
            height: '20',
            viewBox: '0 0 24 24',
            fill: 'none',
            stroke: 'currentColor',
            strokeWidth: '2',
            strokeLinecap: 'round',
            strokeLinejoin: 'round'
        }, React.createElement('polyline', { points: '3 6 5 6 21 6' }), React.createElement('path', { d: 'M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2' }), React.createElement('line', { x1: '10', y1: '11', x2: '10', y2: '17' }), React.createElement('line', { x1: '14', y1: '11', x2: '14', y2: '17' }));

        const Edit2 = () => React.createElement('svg', {
            width: '18',
            height: '18',
            viewBox: '0 0 24 24',
            fill: 'none',
            stroke: 'currentColor',
            strokeWidth: '2',
            strokeLinecap: 'round',
            strokeLinejoin: 'round'
        }, React.createElement('path', { d: 'M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7' }), React.createElement('path', { d: 'M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z' }));

        const Settings = () => React.createElement('svg', {
            width: '20',
            height: '20',
            viewBox: '0 0 24 24',
            fill: 'none',
            stroke: 'currentColor',
            strokeWidth: '2',
            strokeLinecap: 'round',
            strokeLinejoin: 'round'
        }, React.createElement('circle', { cx: '12', cy: '12', r: '3' }), React.createElement('path', { d: 'M12 1v6m0 6v6m5.657-13.657l-4.243 4.243m-2.828 2.828l-4.243 4.243M23 12h-6m-6 0H1m18.364-5.657l-4.243 4.243m-2.828 2.828l-4.243 4.243' }));

        const MessageSquare = () => React.createElement('svg', {
            width: '20',
            height: '20',
            viewBox: '0 0 24 24',
            fill: 'none',
            stroke: 'currentColor',
            strokeWidth: '2',
            strokeLinecap: 'round',
            strokeLinejoin: 'round'
        }, React.createElement('path', { d: 'M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z' }));

        const ChevronDown = () => React.createElement('svg', {
            width: '16',
            height: '16',
            viewBox: '0 0 24 24',
            fill: 'none',
            stroke: 'currentColor',
            strokeWidth: '2',
            strokeLinecap: 'round',
            strokeLinejoin: 'round'
        }, React.createElement('polyline', { points: '6 9 12 15 18 9' }));

        const Building = () => React.createElement('svg', {
            width: '20',
            height: '20',
            viewBox: '0 0 24 24',
            fill: 'none',
            stroke: 'currentColor',
            strokeWidth: '2',
            strokeLinecap: 'round',
            strokeLinejoin: 'round'
        }, React.createElement('rect', { x: '4', y: '2', width: '16', height: '20', rx: '2', ry: '2' }), React.createElement('path', { d: 'M9 22v-4h6v4M8 6h.01M16 6h.01M12 6h.01M12 10h.01M12 14h.01M16 10h.01M16 14h.01M8 10h.01M8 14h.01' }));

        const Folder = () => React.createElement('svg', {
            width: '18',
            height: '18',
            viewBox: '0 0 24 24',
            fill: 'none',
            stroke: 'currentColor',
            strokeWidth: '2',
            strokeLinecap: 'round',
            strokeLinejoin: 'round'
        }, React.createElement('path', { d: 'M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z' }));

        const RefreshCw = ({ size = 20 } = {}) => React.createElement('svg', {
            width: size,
            height: size,
            viewBox: '0 0 24 24',
            fill: 'none',
            stroke: 'currentColor',
            strokeWidth: '2',
            strokeLinecap: 'round',
            strokeLinejoin: 'round'
        }, React.createElement('polyline', { points: '23 4 23 10 17 10' }), React.createElement('polyline', { points: '1 20 1 14 7 14' }), React.createElement('path', { d: 'M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15' }));

        const FolderOpen = () => React.createElement('svg', {
            width: '20',
            height: '20',
            viewBox: '0 0 24 24',
            fill: 'none',
            stroke: 'currentColor',
            strokeWidth: '2',
            strokeLinecap: 'round',
            strokeLinejoin: 'round'
        }, React.createElement('path', { d: 'M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z' }), React.createElement('polyline', { points: '2 8 4 20 20 20 22 8' }));

        const Tag = () => React.createElement('svg', {
            width: '18',
            height: '18',
            viewBox: '0 0 24 24',
            fill: 'none',
            stroke: 'currentColor',
            strokeWidth: '2',
            strokeLinecap: 'round',
            strokeLinejoin: 'round'
        }, React.createElement('path', { d: 'M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z' }), React.createElement('line', { x1: '7', y1: '7', x2: '7.01', y2: '7' }));

        const Bookmark = () => React.createElement('svg', {
            width: '16',
            height: '16',
            viewBox: '0 0 24 24',
            fill: 'none',
            stroke: 'currentColor',
            strokeWidth: '2',
            strokeLinecap: 'round',
            strokeLinejoin: 'round'
        }, React.createElement('path', { d: 'M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z' }));

        // Listen for IPC messages from main process
        let ipcRenderer = null;
        if (typeof require !== 'undefined') {
            ipcRenderer = require('electron').ipcRenderer;

            window.toggleTimerFromTray = () => {
                if (window.currentTimerToggle) {
                    window.currentTimerToggle();
                }
            };

            window.navigateToPage = (page) => {
                if (window.navigateTo) {
                    window.navigateTo(page);
                }
            };

            ipcRenderer.on('toggle-timer', () => {
                window.toggleTimerFromTray();
            });

            ipcRenderer.on('navigate-to', (event, page) => {
                window.navigateToPage(page);
            });

            ipcRenderer.on('export-data-request', () => {
                if (window.exportAllData) {
                    window.exportAllData();
                }
            });

            ipcRenderer.on('import-data-request', () => {
                if (window.importAllData) {
                    window.importAllData();
                }
            });
        }

        // Helper functions for file-based data storage
        const loadDataFromFile = async () => {
            if (!ipcRenderer) {
                // Fallback to localStorage if not in Electron
                return {
                    projectCodes: JSON.parse(localStorage.getItem('projectCodes') || '[]'),
                    timeEntries: JSON.parse(localStorage.getItem('timeEntries') || '[]'),
                    recentProjects: JSON.parse(localStorage.getItem('recentProjects') || '[]'),
                    settings: JSON.parse(localStorage.getItem('settings') || '{}')
                };
            }

            try {
                const result = await ipcRenderer.invoke('load-data');
                if (result.success && result.data) {
                    return result.data;
                }
                return null;
            } catch (error) {
                console.error('Error loading data:', error);
                return null;
            }
        };

        const saveDataToFile = async (data) => {
            if (!ipcRenderer) {
                // Fallback to localStorage if not in Electron
                localStorage.setItem('projectCodes', JSON.stringify(data.projectCodes));
                localStorage.setItem('timeEntries', JSON.stringify(data.timeEntries));
                localStorage.setItem('recentProjects', JSON.stringify(data.recentProjects));
                localStorage.setItem('settings', JSON.stringify(data.settings));
                return;
            }

            try {
                await ipcRenderer.invoke('save-data', data);
            } catch (error) {
                console.error('Error saving data:', error);
            }
        };

        const TimeTracker = () => {
            const [projectCodes, setProjectCodes] = useState([]);
            const [timeEntries, setTimeEntries] = useState([]);
            const [selectedProject, setSelectedProject] = useState('');
            const [isTracking, setIsTracking] = useState(false);
            const [currentSession, setCurrentSession] = useState(null);
            const [elapsedTime, setElapsedTime] = useState(0);
            const [showSetup, setShowSetup] = useState(false);
            const [storageError, setStorageError] = useState(null);
            const [currentPage, setCurrentPage] = useState(1);
            const intervalRef = useRef(null);

            // New state for 4-field structure
            const [newClientName, setNewClientName] = useState('');
            const [newProjectName, setNewProjectName] = useState('');
            const [newTaskCode, setNewTaskCode] = useState('');
            const [newSubtaskCode, setNewSubtaskCode] = useState('');
            const [linkedCSVPath, setLinkedCSVPath] = useState(null);

            // New state for comments
            const [currentComment, setCurrentComment] = useState('');

            // New state for recent projects
            const [recentProjects, setRecentProjects] = useState([]);

            // New state for settings
            const [showSettingsMenu, setShowSettingsMenu] = useState(false);
            const [showGuideModal, setShowGuideModal] = useState(false);
            const [timeRounding, setTimeRounding] = useState('none');
            const [autoPauseEnabled, setAutoPauseEnabled] = useState(false);
            const [autoPauseMinutes, setAutoPauseMinutes] = useState(15);
            const [dailyGoalEnabled, setDailyGoalEnabled] = useState(false);
            const [dailyGoalHours, setDailyGoalHours] = useState(8);
            const [lastActivityTime, setLastActivityTime] = useState(Date.now());
            const [dailyProgressEnabled, setDailyProgressEnabled] = useState(true);
            const [timeSummaryEnabled, setTimeSummaryEnabled] = useState(true);
            const [timeSummaryExpanded, setTimeSummaryExpanded] = useState(true);
            const [shortcutsExpanded, setShortcutsExpanded] = useState(false);
            const [chartPeriod, setChartPeriod] = useState('week'); // 'day', 'week', 'month'

            // License activation state
            const [isLicensed, setIsLicensed] = useState(false);
            const [licenseKey, setLicenseKey] = useState('');
            const [licenseError, setLicenseError] = useState('');
            const [checkingLicense, setCheckingLicense] = useState(true);

            // Manual update check state
            const [updateCheckMessage, setUpdateCheckMessage] = useState('');
            const [showUpdateCheckModal, setShowUpdateCheckModal] = useState(false);

            // Notification settings
            const [fullDayNotificationEnabled, setFullDayNotificationEnabled] = useState(true);
            const [hourlyBreakNotificationEnabled, setHourlyBreakNotificationEnabled] = useState(true);
            const [floatingTimerEnabled, setFloatingTimerEnabled] = useState(false);
            const [lastFullDayNotification, setLastFullDayNotification] = useState(null);
            const [lastHourlyNotification, setLastHourlyNotification] = useState(null);
            const [activeNotification, setActiveNotification] = useState(null);

            // Edit entry state
            const [editingEntry, setEditingEntry] = useState(null);
            const [editFormData, setEditFormData] = useState({});

            // Update notification state
            const [updateAvailable, setUpdateAvailable] = useState(false);
            const [updateInfo, setUpdateInfo] = useState(null);

            // Feedback modal state
            const [showFeedbackModal, setShowFeedbackModal] = useState(false);
            const [feedbackType, setFeedbackType] = useState('suggestion');
            const [feedbackText, setFeedbackText] = useState('');
            const [downloadProgress, setDownloadProgress] = useState(0);
            const [isDownloading, setIsDownloading] = useState(false);
            const [updateDownloaded, setUpdateDownloaded] = useState(false);

            // Time entries search state
            const [timeEntriesSearchTerm, setTimeEntriesSearchTerm] = useState('');

            // Search and hierarchy state
            const [projectSearchTerm, setProjectSearchTerm] = useState('');
            const [expandedClients, setExpandedClients] = useState({});
            const [expandedProjects, setExpandedProjects] = useState({});
            const [expandedTasks, setExpandedTasks] = useState({});

            // CSV filter state
            const [filterStartDate, setFilterStartDate] = useState('');
            const [filterEndDate, setFilterEndDate] = useState('');
            const [filterClient, setFilterClient] = useState('');
            const [filterProject, setFilterProject] = useState('');

            // Cascading dropdown state for Track Time
            const [selectedClient, setSelectedClient] = useState('');
            const [selectedProjectName, setSelectedProjectName] = useState('');
            const [selectedTaskCode, setSelectedTaskCode] = useState('');
            const [selectedSubtaskCode, setSelectedSubtaskCode] = useState('');

            // Check license on startup and auto-activate if needed
            useEffect(() => {
                const checkLicenseStatus = async () => {
                    try {
                        const result = await ipcRenderer.invoke('check-license');

                        if (result.valid) {
                            // Already licensed
                            setIsLicensed(true);
                            setCheckingLicense(false);
                        } else {
                            // Not licensed - try to get a key from the pool and auto-activate
                            try {
                                const keyResult = await ipcRenderer.invoke('get-key-from-pool');

                                if (keyResult.success && keyResult.key) {
                                    // Auto-activate with the pool key
                                    const activationResult = await ipcRenderer.invoke('activate-license', keyResult.key);

                                    if (activationResult.valid) {
                                        setIsLicensed(true);
                                        setLicenseKey(keyResult.key);
                                    } else {
                                        // Activation failed - show manual entry screen
                                        setLicenseError(activationResult.error || 'Auto-activation failed');
                                    }
                                } else {
                                    // No keys in pool - show manual entry screen
                                    setLicenseError('Please enter a valid license key');
                                }
                            } catch (poolError) {
                                console.error('Error getting key from pool:', poolError);
                                setLicenseError('Please enter a valid license key');
                            }

                            setCheckingLicense(false);
                        }
                    } catch (error) {
                        console.error('Error checking license:', error);
                        setIsLicensed(false);
                        setCheckingLicense(false);
                    }
                };

                checkLicenseStatus();
            }, []);

            // Load data from file system
            useEffect(() => {
                if (!isLicensed) return; // Don't load data until licensed

                const loadData = async () => {
                    try {
                        const data = await loadDataFromFile();

                        if (data && data.projectCodes) {
                            setProjectCodes(data.projectCodes);
                            if (data.projectCodes.length === 0) {
                                setShowSetup(true);
                            }
                        } else {
                            setShowSetup(true);
                        }

                        if (data && data.timeEntries) {
                            setTimeEntries(data.timeEntries);
                        }

                        if (data && data.recentProjects) {
                            setRecentProjects(data.recentProjects);
                        } else {
                            // Initialize with empty array if not present
                            setRecentProjects([]);
                        }

                        if (data && data.linkedCSVPath) {
                            setLinkedCSVPath(data.linkedCSVPath);
                        }

                        if (data && data.settings) {
                            const settings = data.settings;
                            setTimeRounding(settings.timeRounding || 'none');
                            setAutoPauseEnabled(settings.autoPauseEnabled || false);
                            setAutoPauseMinutes(settings.autoPauseMinutes || 15);
                            setDailyGoalEnabled(settings.dailyGoalEnabled || false);
                            setDailyGoalHours(settings.dailyGoalHours || 8);
                            setFullDayNotificationEnabled(settings.fullDayNotificationEnabled !== undefined ? settings.fullDayNotificationEnabled : true);
                            setHourlyBreakNotificationEnabled(settings.hourlyBreakNotificationEnabled !== undefined ? settings.hourlyBreakNotificationEnabled : true);
                            setFloatingTimerEnabled(settings.floatingTimerEnabled || false);
                            setLastFullDayNotification(settings.lastFullDayNotification || null);
                            setLastHourlyNotification(settings.lastHourlyNotification || null);
                            setDailyProgressEnabled(settings.dailyProgressEnabled !== undefined ? settings.dailyProgressEnabled : true);
                            setTimeSummaryEnabled(settings.timeSummaryEnabled !== undefined ? settings.timeSummaryEnabled : true);
                            setTimeSummaryExpanded(settings.timeSummaryExpanded !== undefined ? settings.timeSummaryExpanded : true);
                        }

                        // Restore active session if it exists
                        if (data && data.activeSession) {
                            const session = data.activeSession;
                            console.log('Restoring active session:', session);
                            setCurrentSession(session);
                            setIsTracking(true);
                            setElapsedTime(session.elapsedTime || 0);
                            setCurrentComment(session.currentComment || '');
                            setLastActivityTime(Date.now());
                            setSelectedProject(session.projectId);
                        }
                    } catch (error) {
                        console.error('Error loading data:', error);
                        setStorageError('Failed to load data');
                        setShowSetup(true);
                    }
                };

                loadData();
            }, [isLicensed]);

            // Save all data to file whenever anything changes
            useEffect(() => {
                const saveData = async () => {
                    try {
                        const settings = {
                            timeRounding,
                            autoPauseEnabled,
                            autoPauseMinutes,
                            dailyGoalEnabled,
                            dailyGoalHours,
                            fullDayNotificationEnabled,
                            hourlyBreakNotificationEnabled,
                            floatingTimerEnabled,
                            lastFullDayNotification,
                            lastHourlyNotification,
                            dailyProgressEnabled,
                            timeSummaryEnabled,
                            timeSummaryExpanded
                        };

                        // Save current session info if tracking
                        const activeSession = isTracking && currentSession ? {
                            ...currentSession,
                            elapsedTime: elapsedTime,
                            currentComment: currentComment
                        } : null;

                        await saveDataToFile({
                            projectCodes,
                            timeEntries,
                            recentProjects,
                            linkedCSVPath,
                            settings,
                            activeSession
                        });
                    } catch (error) {
                        console.error('Failed to save data:', error);
                    }
                };

                // Debounce saves to avoid too many writes
                const timeoutId = setTimeout(saveData, 500);
                return () => clearTimeout(timeoutId);
            }, [projectCodes, timeEntries, recentProjects, linkedCSVPath, timeRounding, autoPauseEnabled, autoPauseMinutes, dailyGoalEnabled, dailyGoalHours, fullDayNotificationEnabled, hourlyBreakNotificationEnabled, floatingTimerEnabled, lastFullDayNotification, lastHourlyNotification, dailyProgressEnabled, timeSummaryEnabled, timeSummaryExpanded, isTracking, currentSession, elapsedTime, currentComment]);

            // Activity tracking for auto-pause
            useEffect(() => {
                const updateActivity = () => {
                    setLastActivityTime(Date.now());
                };

                if (autoPauseEnabled && isTracking) {
                    window.addEventListener('mousemove', updateActivity);
                    window.addEventListener('keydown', updateActivity);
                    window.addEventListener('click', updateActivity);

                    return () => {
                        window.removeEventListener('mousemove', updateActivity);
                        window.removeEventListener('keydown', updateActivity);
                        window.removeEventListener('click', updateActivity);
                    };
                }
            }, [autoPauseEnabled, isTracking]);

            // Timer effect with auto-pause check
            useEffect(() => {
                if (isTracking && currentSession) {
                    intervalRef.current = setInterval(() => {
                        setElapsedTime(Date.now() - currentSession.startTime);

                        // Check for idle time
                        if (autoPauseEnabled) {
                            const idleTime = Date.now() - lastActivityTime;
                            const idleThreshold = autoPauseMinutes * 60 * 1000;

                            if (idleTime > idleThreshold) {
                                clearInterval(intervalRef.current);
                                const confirmStop = window.confirm(
                                    "You've been idle for " + autoPauseMinutes + " minutes.\n\nWere you still working on \"" + currentSession.projectCode + "\"?"
                                );

                                if (!confirmStop) {
                                    setIsTracking(false);
                                    setCurrentSession(null);
                                    setElapsedTime(0);
                                    setCurrentComment('');
                                } else {
                                    setLastActivityTime(Date.now());
                                    if (isTracking && currentSession) {
                                        intervalRef.current = setInterval(() => {
                                            setElapsedTime(Date.now() - currentSession.startTime);
                                        }, 1000);
                                    }
                                }
                            }
                        }
                    }, 1000);
                } else {
                    if (intervalRef.current) {
                        clearInterval(intervalRef.current);
                    }
                }

                return () => {
                    if (intervalRef.current) {
                        clearInterval(intervalRef.current);
                    }
                };
            }, [isTracking, currentSession, autoPauseEnabled, autoPauseMinutes, lastActivityTime]);

            // Keyboard shortcuts for recent projects (1-9), Enter to start, Space to pause, Arrow keys to toggle pages
            useEffect(() => {
                const handleKeyPress = (e) => {
                    const key = e.key;
                    const isInputField = e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'SELECT';

                    // Left/Right Arrow keys - Toggle between Track Time and Manage Projects (works everywhere except input fields)
                    if ((key === 'ArrowLeft' || key === 'ArrowRight') && !isInputField) {
                        e.preventDefault();
                        if (key === 'ArrowLeft') {
                            setShowSetup(false); // Go to Track Time page
                        } else {
                            setShowSetup(true); // Go to Manage Projects page
                        }
                        return;
                    }

                    // Enter key - Start tracking selected project (works everywhere including input fields)
                    if (key === 'Enter' && !showSetup) {
                        if (!isTracking && selectedProject) {
                            e.preventDefault();
                            startTracking();
                            return;
                        }
                    }

                    // Only trigger other shortcuts if not typing in an input/textarea and on Track Time page
                    if (showSetup || isInputField) {
                        return;
                    }

                    // Space key - Pause/Resume timer
                    if (key === ' ') {
                        e.preventDefault();
                        if (isTracking) {
                            stopTracking();
                        } else if (selectedProject) {
                            startTracking();
                        }
                        return;
                    }

                    // Number keys 1-9 - Quick select recent projects
                    if (key >= '1' && key <= '9') {
                        const index = parseInt(key) - 1;
                        if (index < recentProjects.length && index < 9) {
                            const projectId = recentProjects[index];
                            const project = projectCodes.find(p => p.id === projectId);

                            if (project) {
                                if (isTracking) {
                                    const isCurrentProject = currentSession && currentSession.projectId === projectId;
                                    if (!isCurrentProject) {
                                        switchProject(projectId);
                                    }
                                } else {
                                    setSelectedProject(projectId.toString());
                                }
                            }
                        }
                    }
                };

                window.addEventListener('keydown', handleKeyPress);
                return () => window.removeEventListener('keydown', handleKeyPress);
            }, [showSetup, recentProjects, projectCodes, isTracking, currentSession, selectedProject]);

            // Notification check effect
            useEffect(() => {
                if (!isTracking) return;

                const checkInterval = setInterval(() => {
                    const now = Date.now();
                    const today = new Date().toISOString().split('T')[0];

                    // Check for 8-hour full day notification
                    if (fullDayNotificationEnabled) {
                        const todaysHours = getTodaysTotalHours();
                        if (todaysHours >= 8) {
                            const lastNotifDate = lastFullDayNotification ? new Date(lastFullDayNotification).toISOString().split('T')[0] : null;
                            if (lastNotifDate !== today) {
                                showNotification("🎉 That's a full day's work! You've hit 8 hours. Time to take a break!", 'success');
                                setLastFullDayNotification(now);
                            }
                        }
                    }

                    // Check for hourly break reminder
                    if (hourlyBreakNotificationEnabled && currentSession) {
                        const sessionDuration = now - currentSession.startTime;
                        const hoursPassed = Math.floor(sessionDuration / (1000 * 60 * 60));

                        if (hoursPassed > 0) {
                            const lastNotifHour = lastHourlyNotification ? Math.floor((now - lastHourlyNotification) / (1000 * 60 * 60)) : 999;
                            if (lastNotifHour >= 1) {
                                showNotification("💧 Time for a 5-minute break! Go grab a drink of water.", 'info');
                                setLastHourlyNotification(now);
                            }
                        }
                    }
                }, 30000); // Check every 30 seconds

                return () => clearInterval(checkInterval);
            }, [isTracking, fullDayNotificationEnabled, hourlyBreakNotificationEnabled, currentSession, lastFullDayNotification, lastHourlyNotification, timeEntries, elapsedTime]);

            const formatTime = (milliseconds) => {
                const seconds = Math.floor(milliseconds / 1000);
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                const remainingSeconds = seconds % 60;
                return hours.toString().padStart(2, '0') + ':' + minutes.toString().padStart(2, '0') + ':' + remainingSeconds.toString().padStart(2, '0');
            };

            const getTodaysTotalHours = () => {
                const today = new Date().toISOString().split('T')[0];
                const todaysEntries = timeEntries.filter(entry => entry.date === today);
                const totalHours = todaysEntries.reduce((sum, entry) => sum + entry.hours, 0);

                if (isTracking && currentSession && currentSession.date === today) {
                    const currentHours = elapsedTime / (1000 * 60 * 60);
                    return totalHours + currentHours;
                }
                return totalHours;
            };

            const getThisWeeksTotalHours = () => {
                const now = new Date();
                const startOfWeek = new Date(now);
                startOfWeek.setDate(now.getDate() - now.getDay()); // Sunday
                const startDateStr = startOfWeek.toISOString().split('T')[0];

                const weekEntries = timeEntries.filter(entry => {
                    // String comparison to match export logic exactly
                    return entry.date >= startDateStr;
                });
                const totalHours = weekEntries.reduce((sum, entry) => sum + entry.hours, 0);

                if (isTracking && currentSession) {
                    if (currentSession.date >= startDateStr) {
                        const currentHours = elapsedTime / (1000 * 60 * 60);
                        return totalHours + currentHours;
                    }
                }
                return totalHours;
            };

            const getThisMonthsTotalHours = () => {
                const now = new Date();
                const year = now.getFullYear();
                const month = now.getMonth() + 1; // 1-12
                const monthStr = year + '-' + String(month).padStart(2, '0');

                const monthEntries = timeEntries.filter(entry => {
                    // String comparison: entry.date is "YYYY-MM-DD", monthStr is "YYYY-MM"
                    return entry.date && entry.date.startsWith(monthStr);
                });
                const totalHours = monthEntries.reduce((sum, entry) => sum + entry.hours, 0);

                if (isTracking && currentSession) {
                    if (currentSession.date && currentSession.date.startsWith(monthStr)) {
                        const currentHours = elapsedTime / (1000 * 60 * 60);
                        return totalHours + currentHours;
                    }
                }
                return totalHours;
            };

            // Chart data functions
            const getChartData = () => {
                if (chartPeriod === 'day') {
                    return getTodayChartData();
                } else if (chartPeriod === 'week') {
                    return getWeekChartData();
                } else {
                    return getMonthChartData();
                }
            };

            const getTodayChartData = () => {
                const today = new Date().toISOString().split('T')[0];
                const todaysEntries = timeEntries.filter(entry => entry.date === today);
                const totalHours = todaysEntries.reduce((sum, entry) => sum + entry.hours, 0);
                const currentHours = (isTracking && currentSession && currentSession.date === today) ? elapsedTime / (1000 * 60 * 60) : 0;
                return [{ label: 'Today', hours: totalHours + currentHours }];
            };

            const getWeekChartData = () => {
                const now = new Date();
                const startOfWeek = new Date(now);
                startOfWeek.setDate(now.getDate() - now.getDay());
                startOfWeek.setHours(0, 0, 0, 0);

                const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                const chartData = [];

                for (let i = 0; i < 7; i++) {
                    const date = new Date(startOfWeek);
                    date.setDate(startOfWeek.getDate() + i);
                    const dateStr = date.toISOString().split('T')[0];

                    const dayEntries = timeEntries.filter(entry => entry.date === dateStr);
                    let totalHours = dayEntries.reduce((sum, entry) => sum + entry.hours, 0);

                    if (isTracking && currentSession && currentSession.date === dateStr) {
                        totalHours += elapsedTime / (1000 * 60 * 60);
                    }

                    chartData.push({ label: days[i], hours: totalHours });
                }

                return chartData;
            };

            const getMonthChartData = () => {
                const now = new Date();
                const currentMonth = now.getMonth();
                const currentYear = now.getFullYear();
                const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

                const chartData = [];
                const weekData = {};

                for (let day = 1; day <= daysInMonth; day++) {
                    const date = new Date(currentYear, currentMonth, day);
                    const dateStr = date.toISOString().split('T')[0];
                    const weekNum = Math.ceil(day / 7);

                    const dayEntries = timeEntries.filter(entry => entry.date === dateStr);
                    let totalHours = dayEntries.reduce((sum, entry) => sum + entry.hours, 0);

                    if (isTracking && currentSession && currentSession.date === dateStr) {
                        totalHours += elapsedTime / (1000 * 60 * 60);
                    }

                    weekData[weekNum] = (weekData[weekNum] || 0) + totalHours;
                }

                for (let week in weekData) {
                    chartData.push({ label: `Week ${week}`, hours: weekData[week] });
                }

                return chartData;
            };

            const getProjectChartData = () => {
                const chartData = getChartData();
                const totalHours = chartData.reduce((sum, d) => sum + d.hours, 0);

                if (totalHours === 0) return [];

                let entries = [];
                if (chartPeriod === 'day') {
                    const today = new Date().toISOString().split('T')[0];
                    entries = timeEntries.filter(entry => entry.date === today);
                    if (isTracking && currentSession && currentSession.date === today) {
                        entries = [...entries, { ...currentSession, hours: elapsedTime / (1000 * 60 * 60) }];
                    }
                } else if (chartPeriod === 'week') {
                    const now = new Date();
                    const startOfWeek = new Date(now);
                    startOfWeek.setDate(now.getDate() - now.getDay());
                    startOfWeek.setHours(0, 0, 0, 0);
                    entries = timeEntries.filter(entry => new Date(entry.date) >= startOfWeek);
                    if (isTracking && currentSession) {
                        const sessionDate = new Date(currentSession.date);
                        if (sessionDate >= startOfWeek) {
                            entries = [...entries, { ...currentSession, hours: elapsedTime / (1000 * 60 * 60) }];
                        }
                    }
                } else {
                    const now = new Date();
                    const currentMonth = now.getMonth();
                    const currentYear = now.getFullYear();
                    entries = timeEntries.filter(entry => {
                        const entryDate = new Date(entry.date);
                        return entryDate.getMonth() === currentMonth && entryDate.getFullYear() === currentYear;
                    });
                    if (isTracking && currentSession) {
                        const sessionDate = new Date(currentSession.date);
                        if (sessionDate.getMonth() === currentMonth && sessionDate.getFullYear() === currentYear) {
                            entries = [...entries, { ...currentSession, hours: elapsedTime / (1000 * 60 * 60) }];
                        }
                    }
                }

                const projectHours = {};
                entries.forEach(entry => {
                    // Group by project name (clientName - projectName) instead of task code
                    const projectName = entry.projectName || entry.clientName || 'Unknown';
                    projectHours[projectName] = (projectHours[projectName] || 0) + entry.hours;
                });

                return Object.entries(projectHours).map(([project, hours]) => ({
                    project,
                    hours,
                    percentage: (hours / totalHours * 100).toFixed(1)
                })).sort((a, b) => b.hours - a.hours);
            };

            const getChartTitle = () => {
                if (chartPeriod === 'day') {
                    const today = new Date();
                    return today.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
                } else if (chartPeriod === 'week') {
                    const now = new Date();
                    const startOfWeek = new Date(now);
                    startOfWeek.setDate(now.getDate() - now.getDay());
                    const endOfWeek = new Date(startOfWeek);
                    endOfWeek.setDate(startOfWeek.getDate() + 6);
                    return startOfWeek.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) + ' - ' + endOfWeek.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                } else {
                    const now = new Date();
                    return now.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                }
            };

            const roundTime = (milliseconds) => {
                if (timeRounding === 'none') return milliseconds;
                const minutes = milliseconds / (1000 * 60);
                const roundTo = parseInt(timeRounding);
                // Round UP to the nearest interval (ceiling)
                const roundedMinutes = Math.ceil(minutes / roundTo) * roundTo;
                return roundedMinutes * 60 * 1000;
            };

            const addProjectCode = () => {
                if (!newClientName.trim() || !newProjectName.trim() || !newTaskCode.trim() || !newSubtaskCode.trim()) {
                    setStorageError('Please fill in all 4 fields');
                    return;
                }

                const newProject = {
                    id: Date.now() + Math.random(),
                    clientName: newClientName.trim(),
                    projectName: newProjectName.trim(),
                    taskCode: newTaskCode.trim().toUpperCase(),
                    subtaskCode: newSubtaskCode.trim().toUpperCase(),
                    code: newTaskCode.trim().toUpperCase() + '-' + newSubtaskCode.trim().toUpperCase()
                };

                setProjectCodes(prev => [...prev, newProject]);
                setNewClientName('');
                setNewProjectName('');
                setNewTaskCode('');
                setNewSubtaskCode('');
                setStorageError(null);
            };

            const deleteProjectCode = (id) => {
                setProjectCodes(prev => prev.filter(project => project.id !== id));
            };

            const updateRecentProjects = (projectId) => {
                setRecentProjects(prev => {
                    const newRecent = [projectId, ...prev.filter(id => id !== projectId)].slice(0, 5);
                    return newRecent;
                });
            };

            const startTracking = () => {
                if (!selectedProject) {
                    setStorageError('Please select a project code');
                    return;
                }

                const project = projectCodes.find(p => p.id.toString() === selectedProject.toString());
                if (!project) return;

                const session = {
                    projectId: project.id,
                    projectCode: project.code,
                    clientName: project.clientName,
                    projectName: project.projectName,
                    taskCode: project.taskCode,
                    subtaskCode: project.subtaskCode,
                    startTime: Date.now(),
                    date: new Date().toISOString().split('T')[0]
                };

                setCurrentSession(session);
                setIsTracking(true);
                setElapsedTime(0);
                setStorageError(null);
                setLastActivityTime(Date.now());
                updateRecentProjects(project.id);
            };

            useEffect(() => {
                window.currentTimerToggle = () => {
                    if (isTracking) {
                        stopTracking();
                    } else if (selectedProject) {
                        startTracking();
                    }
                };

                window.openSettings = () => {
                    setShowSettingsMenu(true);
                };

                window.showGuide = () => {
                    setShowGuideModal(true);
                };

                window.navigateTo = (page) => {
                    setShowSetup(page === 'manage');
                };

                window.exportAllData = async () => {
                    if (!ipcRenderer) return;
                    try {
                        const result = await ipcRenderer.invoke('export-data');
                        if (result.success && !result.canceled) {
                            setStorageError('Data exported successfully to: ' + result.path);
                            setTimeout(() => setStorageError(null), 5000);
                        }
                    } catch (error) {
                        setStorageError('Export failed: ' + error.message);
                    }
                };

                window.importAllData = async () => {
                    if (!ipcRenderer) return;
                    try {
                        const result = await ipcRenderer.invoke('import-data');
                        if (result.success && !result.canceled) {
                            // Reload data after import
                            const data = await loadDataFromFile();
                            if (data) {
                                setProjectCodes(data.projectCodes || []);
                                setTimeEntries(data.timeEntries || []);
                                setRecentProjects(data.recentProjects || []);
                                if (data.settings) {
                                    setTimeRounding(data.settings.timeRounding || 'none');
                                    setAutoPauseEnabled(data.settings.autoPauseEnabled || false);
                                    setAutoPauseMinutes(data.settings.autoPauseMinutes || 15);
                                    setCompactMode(data.settings.compactMode || false);
                                    setDailyGoalEnabled(data.settings.dailyGoalEnabled || false);
                                    setDailyGoalHours(data.settings.dailyGoalHours || 8);
                                }
                                setStorageError('Data imported successfully! Please restart the app to see all changes.');
                                setTimeout(() => setStorageError(null), 5000);
                            }
                        }
                    } catch (error) {
                        setStorageError('Import failed: ' + error.message);
                    }
                };
            }, [isTracking, selectedProject]);

            // Listen for show-guide IPC event
            useEffect(() => {
                if (!ipcRenderer) return;

                const handleShowGuide = () => {
                    setShowGuideModal(true);
                };

                ipcRenderer.on('show-guide', handleShowGuide);

                return () => {
                    ipcRenderer.removeListener('show-guide', handleShowGuide);
                };
            }, []);

            // Listen for open-settings IPC event
            useEffect(() => {
                if (!ipcRenderer) return;

                const handleOpenSettings = () => {
                    setShowSettingsMenu(true);
                };

                ipcRenderer.on('open-settings', handleOpenSettings);

                return () => {
                    ipcRenderer.removeListener('open-settings', handleOpenSettings);
                };
            }, []);

            // Listen for update events
            useEffect(() => {
                if (!ipcRenderer) return;

                const handleUpdateAvailable = (event, info) => {
                    console.log('Update available:', info);
                    setUpdateAvailable(true);
                    setUpdateInfo(info);
                    setShowUpdateCheckModal(false); // Close manual check modal if open
                };

                const handleDownloadProgress = (event, progressObj) => {
                    console.log('Download progress:', progressObj);
                    setDownloadProgress(progressObj.percent);
                };

                const handleUpdateDownloaded = (event, info) => {
                    console.log('Update downloaded:', info);
                    setIsDownloading(false);
                    setUpdateDownloaded(true);
                };

                const handleUpdateError = (event, error) => {
                    console.error('Update error:', error);
                    setIsDownloading(false);
                };

                ipcRenderer.on('update-available', handleUpdateAvailable);
                ipcRenderer.on('download-progress', handleDownloadProgress);
                ipcRenderer.on('update-downloaded', handleUpdateDownloaded);
                ipcRenderer.on('update-error', handleUpdateError);

                const handleShowFeedback = () => {
                    setShowFeedbackModal(true);
                };
                ipcRenderer.on('show-feedback', handleShowFeedback);

                const handleManualCheckForUpdates = async () => {
                    setUpdateCheckMessage('Checking for updates...');
                    setShowUpdateCheckModal(true);
                    await ipcRenderer.invoke('check-for-updates');
                };
                ipcRenderer.on('manual-check-for-updates', handleManualCheckForUpdates);

                const handleUpdateNotAvailable = () => {
                    setUpdateCheckMessage('You are already running the latest version!');
                };
                ipcRenderer.on('update-not-available', handleUpdateNotAvailable);

                return () => {
                    ipcRenderer.removeListener('update-available', handleUpdateAvailable);
                    ipcRenderer.removeListener('download-progress', handleDownloadProgress);
                    ipcRenderer.removeListener('update-downloaded', handleUpdateDownloaded);
                    ipcRenderer.removeListener('update-error', handleUpdateError);
                    ipcRenderer.removeListener('show-feedback', handleShowFeedback);
                    ipcRenderer.removeListener('manual-check-for-updates', handleManualCheckForUpdates);
                    ipcRenderer.removeListener('update-not-available', handleUpdateNotAvailable);
                };
            }, []);

            // Handle floating timer window toggle
            useEffect(() => {
                if (!ipcRenderer) return;
                ipcRenderer.send('toggle-floating-timer', floatingTimerEnabled);
            }, [floatingTimerEnabled]);

            // Send timer updates to floating window
            useEffect(() => {
                if (!ipcRenderer) return;

                if (floatingTimerEnabled && isTracking && currentSession) {
                    const timerData = {
                        elapsedTime,
                        projectCode: currentSession.projectCode,
                        clientName: currentSession.clientName,
                        projectName: currentSession.projectName,
                        taskCode: currentSession.taskCode,
                        subtaskCode: currentSession.subtaskCode
                    };

                    ipcRenderer.send('update-floating-timer', timerData);
                }
            }, [floatingTimerEnabled, isTracking, currentSession, elapsedTime]);

            const stopTracking = () => {
                if (currentSession) {
                    const endTime = Date.now();
                    const duration = roundTime(endTime - currentSession.startTime);

                    const newEntry = {
                        id: Date.now() + Math.random(),
                        projectId: currentSession.projectId,
                        projectCode: currentSession.projectCode,
                        clientName: currentSession.clientName,
                        projectName: currentSession.projectName,
                        taskCode: currentSession.taskCode,
                        subtaskCode: currentSession.subtaskCode,
                        date: currentSession.date,
                        startTime: new Date(currentSession.startTime).toLocaleTimeString(),
                        endTime: new Date(endTime).toLocaleTimeString(),
                        duration: duration,
                        hours: duration / (1000 * 60 * 60),
                        comment: currentComment
                    };

                    setTimeEntries(prev => [...prev, newEntry]);
                    setIsTracking(false);
                    setCurrentSession(null);
                    setElapsedTime(0);
                    setCurrentComment('');
                }
            };

            const switchProject = (newProjectId) => {
                console.log('switchProject called with:', newProjectId, 'type:', typeof newProjectId);

                // Use loose equality (==) to handle type differences and compare using Math.floor for floating point issues
                const targetId = Math.floor(typeof newProjectId === 'string' ? parseFloat(newProjectId) : newProjectId);
                console.log('Normalized target ID:', targetId);

                const project = projectCodes.find(p => {
                    const projectId = Math.floor(typeof p.id === 'string' ? parseFloat(p.id) : p.id);
                    console.log('Checking project:', projectId, 'against', targetId, 'Match:', projectId == targetId);
                    return projectId == targetId;
                });

                console.log('Found project:', project);

                if (!project) {
                    console.error('Project not found!');
                    console.error('Available project IDs:', projectCodes.map(p => p.id));
                    return;
                }

                // Save the current session to create a time entry before switching
                if (isTracking && currentSession) {
                    console.log('Saving current session');
                    const endTime = Date.now();
                    const duration = roundTime(endTime - currentSession.startTime);

                    const newEntry = {
                        id: Date.now() + Math.random(),
                        projectId: currentSession.projectId,
                        projectCode: currentSession.projectCode,
                        clientName: currentSession.clientName,
                        projectName: currentSession.projectName,
                        taskCode: currentSession.taskCode,
                        subtaskCode: currentSession.subtaskCode,
                        date: currentSession.date,
                        startTime: new Date(currentSession.startTime).toLocaleTimeString(),
                        endTime: new Date(endTime).toLocaleTimeString(),
                        duration: duration,
                        hours: duration / (1000 * 60 * 60),
                        comment: currentComment
                    };

                    setTimeEntries(prev => [...prev, newEntry]);
                }

                // Create new session for the new project
                const newSession = {
                    projectId: project.id,
                    projectCode: project.code,
                    clientName: project.clientName,
                    projectName: project.projectName,
                    taskCode: project.taskCode,
                    subtaskCode: project.subtaskCode,
                    startTime: Date.now(),
                    date: new Date().toISOString().split('T')[0]
                };

                console.log('Setting new session:', newSession);

                // Update all states together
                setCurrentSession(newSession);
                setIsTracking(true);
                setElapsedTime(0);
                setCurrentComment('');
                setLastActivityTime(Date.now());
                updateRecentProjects(project.id);

                console.log('Switch complete!');
            };

            const deleteEntry = (id) => {
                setTimeEntries(prev => prev.filter(entry => entry.id !== id));
            };

            const startEditEntry = (entry) => {
                // Convert locale time string (e.g., "3:45:30 PM") to 24-hour format (e.g., "15:45:30") for time input
                const convertToTimeInputFormat = (timeStr) => {
                    if (!timeStr) return '';
                    // If already in 24-hour format (HH:MM:SS), return as is
                    if (/^\d{2}:\d{2}(:\d{2})?$/.test(timeStr)) return timeStr;

                    // Parse locale time string
                    const today = new Date().toISOString().split('T')[0];
                    const dateTimeStr = today + ' ' + timeStr;
                    const date = new Date(dateTimeStr);

                    if (isNaN(date.getTime())) return timeStr; // Return original if parse fails

                    const hours = String(date.getHours()).padStart(2, '0');
                    const minutes = String(date.getMinutes()).padStart(2, '0');
                    const seconds = String(date.getSeconds()).padStart(2, '0');
                    return `${hours}:${minutes}:${seconds}`;
                };

                setEditingEntry(entry.id);
                setEditFormData({
                    date: entry.date,
                    startTime: convertToTimeInputFormat(entry.startTime),
                    endTime: convertToTimeInputFormat(entry.endTime),
                    comment: entry.comment || '',
                    projectId: entry.projectId
                });
            };

            const cancelEditEntry = () => {
                setEditingEntry(null);
                setEditFormData({});
            };

            const saveEditEntry = () => {
                if (!editingEntry) return;

                setTimeEntries(prev => prev.map(entry => {
                    if (entry.id === editingEntry) {
                        // Parse times to calculate new duration
                        const [startHour, startMin, startSec] = editFormData.startTime.split(':').map(Number);
                        const [endHour, endMin, endSec] = editFormData.endTime.split(':').map(Number);

                        const startMs = (startHour * 3600 + startMin * 60 + (startSec || 0)) * 1000;
                        const endMs = (endHour * 3600 + endMin * 60 + (endSec || 0)) * 1000;

                        let duration = endMs - startMs;
                        if (duration < 0) duration += 24 * 3600 * 1000; // Handle overnight

                        // Get updated project information if project was changed
                        const project = projectCodes.find(p => p.id === editFormData.projectId);

                        return {
                            ...entry,
                            date: editFormData.date,
                            startTime: editFormData.startTime,
                            endTime: editFormData.endTime,
                            duration: duration,
                            hours: duration / (1000 * 60 * 60),
                            comment: editFormData.comment,
                            projectId: editFormData.projectId,
                            projectCode: project ? project.code : entry.projectCode,
                            clientName: project ? project.clientName : entry.clientName,
                            projectName: project ? project.projectName : entry.projectName,
                            taskCode: project ? project.taskCode : entry.taskCode,
                            subtaskCode: project ? project.subtaskCode : entry.subtaskCode
                        };
                    }
                    return entry;
                }));

                cancelEditEntry();
            };

            const activateLicense = async () => {
                setLicenseError('');
                const trimmedKey = licenseKey.trim();

                if (!trimmedKey) {
                    setLicenseError('Please enter a license key');
                    return;
                }

                try {
                    const result = await ipcRenderer.invoke('activate-license', trimmedKey);
                    if (result.valid) {
                        setIsLicensed(true);
                        setLicenseError('');
                    } else {
                        setLicenseError(result.error || 'Invalid license key');
                    }
                } catch (error) {
                    console.error('Error activating license:', error);
                    setLicenseError('Failed to activate license');
                }
            };

            const showNotification = (message, type = 'info') => {
                console.log("showNotification called with:", message, type);
                const notif = { message, type };
                console.log("Setting activeNotification to:", notif);
                setActiveNotification(notif);
                setTimeout(() => {
                    console.log("Clearing notification");
                    setActiveNotification(null);
                }, 5000);
            };

            const addDemoData = () => {
                const demoProjects = [
                    { id: 1, clientName: 'Orbital', projectName: 'O2-X Habitat Offsetting Plan', taskCode: '1. MEETINGS AND DELIVERY', subtaskCode: '1.1 PROJECT', code: '1. MEETINGS AND DELIVERY-1.1 PROJECT' },
                    { id: 2, clientName: 'Orbital', projectName: 'O2-X Habitat Offsetting Plan', taskCode: '1. MEETINGS AND DELIVERY', subtaskCode: '1.2 INTERNAL', code: '1. MEETINGS AND DELIVERY-1.2 INTERNAL' },
                    { id: 3, clientName: 'Orbital', projectName: 'O2-X Habitat Offsetting Plan', taskCode: '1. MEETINGS AND DELIVERY', subtaskCode: '1.3 REGULATORY', code: '1. MEETINGS AND DELIVERY-1.3 REGULATORY' }
                ];
                setProjectCodes(demoProjects);
                setShowSetup(false);
            };

            const downloadCSVTemplate = () => {
                const csvContent = [
                    'Client Name,Project/Admin Name,Task Code,Subtask Code',
                    'Orbital,O2-X Habitat Offsetting Plan,1. Meetings and Delivery,1.1 Project',
                    'Orbital,O2-X Habitat Offsetting Plan,1. Meetings and Delivery,1.2 Internal',
                    'Orbital,O2-X Habitat Offsetting Plan,1. Meetings and Delivery,1.3 Regulatory'
                ].join('\n');

                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'timesheet-template.csv';
                a.click();
                window.URL.revokeObjectURL(url);
            };

            // Update handler functions
            const handleDownloadUpdate = async () => {
                setIsDownloading(true);
                await ipcRenderer.invoke('download-update');
            };

            const handleInstallUpdate = async () => {
                await ipcRenderer.invoke('install-update');
            };

            const handleDismissUpdate = () => {
                setUpdateAvailable(false);
                setUpdateDownloaded(false);
            };

            const handleCSVImport = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const text = e.target.result;
                        const lines = text.split('\n').filter(line => line.trim());
                        const dataLines = lines.slice(1);

                        const importedProjects = dataLines.map((line, index) => {
                            const values = line.split(',').map(v => v.trim());
                            if (values.length < 4) {
                                throw new Error("Line " + (index + 2) + ": Expected 4 columns, got " + values.length);
                            }

                            const [clientName, projectName, taskCode, subtaskCode] = values;
                            return {
                                id: Date.now() + Math.random() + index,
                                clientName,
                                projectName,
                                taskCode: taskCode.toUpperCase(),
                                subtaskCode: subtaskCode.toUpperCase(),
                                code: taskCode.toUpperCase() + '-' + subtaskCode.toUpperCase()
                            };
                        });

                        setProjectCodes(prev => [...prev, ...importedProjects]);
                        console.log("Calling showNotification after file input import");
                        showNotification("Project code(s) successfully uploaded", 'success');

                        event.target.value = '';
                    } catch (error) {
                        console.log("Import error:", error);
                        showNotification("Import failed: " + error.message, 'info');
                    }
                };
                reader.readAsText(file);
            };

            const browseCSVFile = async () => {
                try {
                    const result = await window.require('electron').ipcRenderer.invoke('browse-csv-file');
                    if (result.success && result.content) {
                        const text = result.content;
                        const lines = text.split('\n').filter(line => line.trim());
                        const dataLines = lines.slice(1);

                        const importedProjects = dataLines.map((line, index) => {
                            const values = line.split(',').map(v => v.trim());
                            if (values.length < 4) {
                                throw new Error("Line " + (index + 2) + ": Expected 4 columns, got " + values.length);
                            }

                            const [clientName, projectName, taskCode, subtaskCode] = values;
                            return {
                                id: Date.now() + Math.random() + index,
                                clientName,
                                projectName,
                                taskCode: taskCode.toUpperCase(),
                                subtaskCode: subtaskCode.toUpperCase(),
                                code: taskCode.toUpperCase() + '-' + subtaskCode.toUpperCase()
                            };
                        });

                        setProjectCodes(prev => [...prev, ...importedProjects]);
                        setLinkedCSVPath(result.path);
                        console.log("Calling showNotification after browse CSV import");
                        showNotification("Project code(s) successfully uploaded and linked", 'success');
                    } else if (result.canceled) {
                        // User canceled, do nothing
                    } else {
                        showNotification("Failed to browse CSV file: " + (result.error || "Unknown error"), 'info');
                    }
                } catch (error) {
                    console.log("Browse CSV error:", error);
                    showNotification("Import failed: " + error.message, 'info');
                }
            };

            const refreshFromCSV = async () => {
                if (!linkedCSVPath) {
                    showNotification("No linked CSV file. Please browse and select a CSV file first.", 'info');
                    return;
                }

                try {
                    const fs = window.require('fs');
                    const csvContent = fs.readFileSync(linkedCSVPath, 'utf8');
                    const lines = csvContent.split('\n').filter(line => line.trim());
                    const dataLines = lines.slice(1);

                    const importedProjects = dataLines.map((line, index) => {
                        const values = line.split(',').map(v => v.trim());
                        if (values.length < 4) {
                            throw new Error("Line " + (index + 2) + ": Expected 4 columns, got " + values.length);
                        }

                        const [clientName, projectName, taskCode, subtaskCode] = values;
                        return {
                            id: Date.now() + Math.random() + index,
                            clientName,
                            projectName,
                            taskCode: taskCode.toUpperCase(),
                            subtaskCode: subtaskCode.toUpperCase(),
                            code: taskCode.toUpperCase() + '-' + subtaskCode.toUpperCase()
                        };
                    });

                    setProjectCodes(importedProjects);
                    showNotification("Refreshed " + importedProjects.length + " project code(s) from CSV", 'success');
                } catch (error) {
                    console.log("Refresh CSV error:", error);
                    showNotification("Failed to refresh from CSV: " + error.message, 'info');
                    // Clear invalid path
                    setLinkedCSVPath(null);
                }
            };

            const deleteAllByClient = (clientName) => {
                const confirmed = window.confirm("Delete all projects for client \"" + clientName + "\"?\n\nThis cannot be undone.");
                if (confirmed) {
                    const remaining = projectCodes.filter(p => p.clientName !== clientName);
                    const deleted = projectCodes.length - remaining.length;
                    setProjectCodes(remaining);
                    setStorageError("Deleted " + deleted + " project(s) for " + clientName);
                }
            };

            const deleteAllByProject = (clientName, projectName) => {
                const confirmed = window.confirm("Delete all codes for \"" + projectName + "\" under client \"" + clientName + "\"?\n\nThis cannot be undone.");
                if (confirmed) {
                    const remaining = projectCodes.filter(p => !(p.clientName === clientName && p.projectName === projectName));
                    const deleted = projectCodes.length - remaining.length;
                    setProjectCodes(remaining);
                    setStorageError("Deleted " + deleted + " code(s) for " + projectName);
                }
            };

            const toggleClient = (clientName) => {
                setExpandedClients(prev => ({
                    ...prev,
                    [clientName]: !prev[clientName]
                }));
            };

            const toggleProject = (clientName, projectName) => {
                const key = clientName + "::" + projectName;
                setExpandedProjects(prev => ({
                    ...prev,
                    [key]: !prev[key]
                }));
            };

            const toggleTask = (clientName, projectName, taskCode) => {
                const key = clientName + "::" + projectName + "::" + taskCode;
                setExpandedTasks(prev => ({
                    ...prev,
                    [key]: !prev[key]
                }));
            };

            const organizeProjectsByHierarchy = () => {
                const searchLower = projectSearchTerm.toLowerCase();
                const filtered = projectCodes.filter(p =>
                    !projectSearchTerm ||
                    p.clientName.toLowerCase().includes(searchLower) ||
                    p.projectName.toLowerCase().includes(searchLower) ||
                    p.code.toLowerCase().includes(searchLower)
                );

                const hierarchy = {};
                filtered.forEach(project => {
                    if (!hierarchy[project.clientName]) {
                        hierarchy[project.clientName] = {};
                    }
                    if (!hierarchy[project.clientName][project.projectName]) {
                        hierarchy[project.clientName][project.projectName] = {};
                    }
                    if (!hierarchy[project.clientName][project.projectName][project.taskCode]) {
                        hierarchy[project.clientName][project.projectName][project.taskCode] = [];
                    }
                    hierarchy[project.clientName][project.projectName][project.taskCode].push(project);
                });

                return hierarchy;
            };

            const exportToCSV = () => {
                if (timeEntries.length === 0) {
                    setStorageError('No entries to export');
                    return;
                }

                const filteredEntries = timeEntries.filter(entry => {
                    let matches = true;
                    if (filterStartDate && entry.date < filterStartDate) matches = false;
                    if (filterEndDate && entry.date > filterEndDate) matches = false;
                    if (filterClient && entry.clientName !== filterClient) matches = false;
                    if (filterProject && entry.projectName !== filterProject) matches = false;
                    return matches;
                });

                if (filteredEntries.length === 0) {
                    setStorageError('No entries match the filters');
                    return;
                }

                const dateRange = filterStartDate && filterEndDate
                    ? filterStartDate + " to " + filterEndDate
                    : 'All Dates';

                const projectSummary = {};
                filteredEntries.forEach(entry => {
                    const key = entry.projectCode;
                    if (!projectSummary[key]) {
                        projectSummary[key] = {
                            code: entry.projectCode,
                            client: entry.clientName,
                            project: entry.projectName,
                            totalHours: 0
                        };
                    }
                    projectSummary[key].totalHours += entry.hours;
                });

                const summaryHeaders = ['Project Code', 'Client', 'Project', 'Total Hours'];
                const summaryRows = Object.values(projectSummary).map(proj => [
                    proj.code,
                    proj.client,
                    proj.project,
                    proj.totalHours.toFixed(2)
                ]);

                const detailHeaders = ['Date', 'Project Code', 'Client', 'Project', 'Task', 'Subtask', 'Start', 'End', 'Hours', 'Comment'];
                const detailRows = filteredEntries.map(entry => [
                    entry.date,
                    entry.projectCode,
                    entry.clientName,
                    entry.projectName,
                    entry.taskCode,
                    entry.subtaskCode,
                    entry.startTime,
                    entry.endTime,
                    entry.hours.toFixed(2),
                    entry.comment || ''
                ]);

                const csvContent = [
                    "Timesheet Export - " + dateRange,
                    filterClient ? "Client: " + filterClient : '',
                    filterProject ? "Project: " + filterProject : '',
                    '',
                    'PROJECT SUMMARY',
                    summaryHeaders.join(','),
                    ...summaryRows.map(row => row.join(',')),
                    '',
                    "Total Hours: " + filteredEntries.reduce((sum, e) => sum + e.hours, 0).toFixed(2),
                    '',
                    'DETAILED ENTRIES',
                    detailHeaders.join(','),
                    ...detailRows.map(row => row.join(','))
                ].join('\n');

                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = "timesheet-" + (filterStartDate || 'all') + "-" + (filterEndDate || 'dates') + ".csv";
                a.click();
                window.URL.revokeObjectURL(url);
            };

            const exportToExcel = async () => {
                if (timeEntries.length === 0) {
                    setStorageError('No entries to export');
                    return;
                }

                const filteredEntries = timeEntries.filter(entry => {
                    let matches = true;
                    if (filterStartDate && entry.date < filterStartDate) matches = false;
                    if (filterEndDate && entry.date > filterEndDate) matches = false;
                    if (filterClient && entry.clientName !== filterClient) matches = false;
                    if (filterProject && entry.projectName !== filterProject) matches = false;
                    return matches;
                });

                if (filteredEntries.length === 0) {
                    setStorageError('No entries match the filters');
                    return;
                }

                try {
                    const ExcelJS = window.require('exceljs');
                    const workbook = new ExcelJS.Workbook();
                    const worksheet = workbook.addWorksheet('ThymeSheet (ALL)');

                    // Calculate project summary
                    const projectSummary = {};
                    let grandTotal = 0;
                    filteredEntries.forEach(entry => {
                        const projectName = entry.projectName;
                        if (!projectSummary[projectName]) {
                            projectSummary[projectName] = 0;
                        }
                        projectSummary[projectName] += entry.hours;
                        grandTotal += entry.hours;
                    });

                    // Convert to array
                    const projectSummaryArray = Object.entries(projectSummary).map(([project, hours]) => ({
                        project,
                        hours
                    }));

                    // PROJECT SUMMARY TABLE
                    worksheet.addRow(['PROJECT SUMMARY']);
                    worksheet.getCell('A1').font = { bold: true, size: 14 };
                    worksheet.addRow([]);

                    const summaryHeaderRow = worksheet.addRow(['Project Name', 'Total Hours']);
                    summaryHeaderRow.font = { bold: true };
                    summaryHeaderRow.eachCell((cell) => {
                        cell.fill = {
                            type: 'pattern',
                            pattern: 'solid',
                            fgColor: { argb: 'FF4A7C59' }
                        };
                        cell.font = { bold: true, color: { argb: 'FFFFFFFF' } };
                        cell.border = {
                            top: { style: 'thin' },
                            left: { style: 'thin' },
                            bottom: { style: 'thin' },
                            right: { style: 'thin' }
                        };
                    });

                    projectSummaryArray.forEach(proj => {
                        const row = worksheet.addRow([proj.project, parseFloat(proj.hours.toFixed(2))]);
                        row.eachCell((cell) => {
                            cell.border = {
                                top: { style: 'thin' },
                                left: { style: 'thin' },
                                bottom: { style: 'thin' },
                                right: { style: 'thin' }
                            };
                        });
                    });

                    const summaryLastRow = 3 + projectSummaryArray.length;

                    // DETAILED TIMESHEET TABLE
                    const detailStartRow = summaryLastRow + 3;
                    worksheet.addRow([]);
                    worksheet.getCell('A' + detailStartRow).value = 'DETAILED TIMESHEET';
                    worksheet.getCell('A' + detailStartRow).font = { bold: true, size: 14 };

                    worksheet.addRow([]);

                    const detailHeaderRow = worksheet.addRow([
                        'Week of Month',
                        'Date',
                        'Project Name',
                        'Task Name',
                        'Subtask Name',
                        'Hours',
                        'Comment',
                        'Daily Total',
                        'Weekly Total'
                    ]);
                    detailHeaderRow.font = { bold: true };
                    detailHeaderRow.eachCell((cell) => {
                        cell.fill = {
                            type: 'pattern',
                            pattern: 'solid',
                            fgColor: { argb: 'FF4A7C59' }
                        };
                        cell.font = { bold: true, color: { argb: 'FFFFFFFF' } };
                        cell.border = {
                            top: { style: 'thin' },
                            left: { style: 'thin' },
                            bottom: { style: 'thin' },
                            right: { style: 'thin' }
                        };
                    });

                    // Sort entries by date
                    const sortedEntries = [...filteredEntries].sort((a, b) => a.date.localeCompare(b.date));

                    // Calculate daily and weekly totals
                    const dailyTotals = {};
                    const weeklyTotals = {};
                    sortedEntries.forEach(entry => {
                        // Daily totals
                        if (!dailyTotals[entry.date]) {
                            dailyTotals[entry.date] = 0;
                        }
                        dailyTotals[entry.date] += entry.hours;

                        // Weekly totals (week starting Sunday)
                        const entryDate = new Date(entry.date);
                        const dayOfWeek = entryDate.getDay();
                        const weekStart = new Date(entryDate);
                        weekStart.setDate(entryDate.getDate() - dayOfWeek);
                        const weekKey = weekStart.toISOString().split('T')[0];

                        if (!weeklyTotals[weekKey]) {
                            weeklyTotals[weekKey] = 0;
                        }
                        weeklyTotals[weekKey] += entry.hours;
                    });

                    // Function to get week of month
                    const getWeekOfMonth = (dateStr) => {
                        const date = new Date(dateStr);
                        const firstDay = new Date(date.getFullYear(), date.getMonth(), 1);
                        const dayOfWeek = firstDay.getDay();
                        const offsetDate = date.getDate() + dayOfWeek - 1;
                        return Math.ceil(offsetDate / 7);
                    };

                    // Function to get week start date
                    const getWeekStart = (dateStr) => {
                        const date = new Date(dateStr);
                        const dayOfWeek = date.getDay();
                        const weekStart = new Date(date);
                        weekStart.setDate(date.getDate() - dayOfWeek);
                        return weekStart.toISOString().split('T')[0];
                    };

                    // Add detail rows
                    let currentWeekStart = null;
                    let currentDate = null;
                    sortedEntries.forEach((entry, index) => {
                        const weekStart = getWeekStart(entry.date);
                        const isNewWeek = weekStart !== currentWeekStart;
                        const isNewDay = entry.date !== currentDate;

                        currentWeekStart = weekStart;
                        currentDate = entry.date;

                        const weekOfMonth = getWeekOfMonth(entry.date);

                        // Format date as "Month Day, Year" (using string parsing to avoid timezone issues)
                        const dateParts = entry.date.split('-');
                        const year = parseInt(dateParts[0]);
                        const month = parseInt(dateParts[1]) - 1; // 0-indexed for month names
                        const day = parseInt(dateParts[2]);
                        const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                                           'July', 'August', 'September', 'October', 'November', 'December'];
                        const formattedDate = monthNames[month] + ' ' + day + ', ' + year;

                        // Check if this is the first entry for this date
                        const isFirstEntryForDate = index === 0 || sortedEntries[index - 1].date !== entry.date;

                        // Check if this is the first entry for this week
                        const isFirstEntryForWeek = index === 0 || getWeekStart(sortedEntries[index - 1].date) !== weekStart;

                        // Check if this is the last entry for this week
                        const isLastEntryForWeek = index === sortedEntries.length - 1 || getWeekStart(sortedEntries[index + 1].date) !== weekStart;

                        const row = worksheet.addRow([
                            'Week ' + weekOfMonth,
                            formattedDate,
                            entry.projectName,
                            entry.taskCode,
                            entry.subtaskCode,
                            parseFloat(entry.hours.toFixed(2)),
                            entry.comment || '',
                            isFirstEntryForDate ? parseFloat(dailyTotals[entry.date].toFixed(2)) : '',
                            isFirstEntryForWeek ? parseFloat(weeklyTotals[weekStart].toFixed(2)) : ''
                        ]);

                        // Apply borders - bold borders for week boundaries
                        row.eachCell((cell) => {
                            cell.border = {
                                top: { style: isFirstEntryForWeek ? 'medium' : 'thin' },
                                left: { style: 'thin' },
                                bottom: { style: isLastEntryForWeek ? 'medium' : 'thin' },
                                right: { style: 'thin' }
                            };
                        });
                    });

                    // Add grand total row
                    const grandTotalRow = worksheet.addRow([
                        '', '', '', '', '', '', '', 'GRAND TOTAL:', parseFloat(grandTotal.toFixed(2))
                    ]);
                    grandTotalRow.font = { bold: true };
                    grandTotalRow.getCell(8).font = { bold: true };
                    grandTotalRow.getCell(9).font = { bold: true };
                    grandTotalRow.eachCell((cell) => {
                        cell.border = {
                            top: { style: 'thin' },
                            left: { style: 'thin' },
                            bottom: { style: 'thin' },
                            right: { style: 'thin' }
                        };
                    });

                    // Auto-fit columns
                    worksheet.columns.forEach((column) => {
                        let maxLength = 0;
                        column.eachCell({ includeEmpty: false }, (cell) => {
                            const cellValue = cell.value ? cell.value.toString() : '';
                            if (cellValue.length > maxLength) {
                                maxLength = cellValue.length;
                            }
                        });
                        column.width = Math.min(Math.max(maxLength + 2, 10), 50);
                    });

                    // ========================================
                    // WORLEY SHEET (only if there are Worley entries)
                    // ========================================
                    const worleyEntries = filteredEntries.filter(entry =>
                        entry.clientName && entry.clientName.toLowerCase().includes('worley')
                    );

                    if (worleyEntries.length > 0) {
                        const worleySheet = workbook.addWorksheet('Worley');

                        // Generate ALL dates in the range (not just dates with hours)
                        const allDates = [];
                        if (filterStartDate && filterEndDate) {
                            // Use string manipulation to avoid timezone issues
                            let currentDate = filterStartDate;
                            const endDate = filterEndDate;
                            while (currentDate <= endDate) {
                                allDates.push(currentDate);
                                // Increment date by adding one day
                                const parts = currentDate.split('-');
                                const year = parseInt(parts[0]);
                                const month = parseInt(parts[1]) - 1;
                                const day = parseInt(parts[2]);
                                const nextDate = new Date(year, month, day + 1);
                                currentDate = nextDate.getFullYear() + '-' +
                                             String(nextDate.getMonth() + 1).padStart(2, '0') + '-' +
                                             String(nextDate.getDate()).padStart(2, '0');
                            }
                        } else {
                            // If no date filter, use dates from entries
                            const uniqueDatesSet = new Set(worleyEntries.map(e => e.date));
                            allDates.push(...Array.from(uniqueDatesSet).sort());
                        }

                        // Format dates as M/D/YYYY (using string parsing to avoid timezone issues)
                        const formattedDates = allDates.map(dateStr => {
                            const parts = dateStr.split('-');
                            const year = parseInt(parts[0]);
                            const month = parseInt(parts[1]);
                            const day = parseInt(parts[2]);
                            return month + '/' + day + '/' + year;
                        });

                        // Group Worley entries by Work Item, Project No, and Task Code
                        const worleyData = {};
                        worleyEntries.forEach(entry => {
                            const key = entry.projectName + '|' + entry.projectCode + '|' + entry.taskCode;
                            if (!worleyData[key]) {
                                worleyData[key] = {
                                    workItem: entry.projectName,
                                    projectNo: entry.projectCode,
                                    taskCode: entry.taskCode,
                                    dateHours: {},
                                    total: 0
                                };
                            }
                            if (!worleyData[key].dateHours[entry.date]) {
                                worleyData[key].dateHours[entry.date] = 0;
                            }
                            worleyData[key].dateHours[entry.date] += entry.hours;
                            worleyData[key].total += entry.hours;
                        });

                        // Build header row
                        const worleyHeaders = ['Work Item', 'Project No.', 'Task Code', ...formattedDates, 'Total'];
                        const worleyHeaderRow = worleySheet.addRow(worleyHeaders);

                        // Style header row (green like ThymeSheet)
                        worleyHeaderRow.font = { bold: true };
                        worleyHeaderRow.eachCell((cell) => {
                            cell.fill = {
                                type: 'pattern',
                                pattern: 'solid',
                                fgColor: { argb: 'FF4A7C59' }
                            };
                            cell.font = { bold: true, color: { argb: 'FFFFFFFF' } };
                            cell.border = {
                                top: { style: 'thin' },
                                left: { style: 'thin' },
                                bottom: { style: 'thin' },
                                right: { style: 'thin' }
                            };
                        });

                        // Add data rows
                        Object.values(worleyData).forEach(item => {
                            const rowData = [
                                item.workItem,
                                item.projectNo,
                                item.taskCode
                            ];

                            // Add hours for each date (including 0 for dates with no hours)
                            allDates.forEach(date => {
                                const hours = item.dateHours[date] || 0;
                                rowData.push(hours);
                            });

                            // Add total
                            rowData.push(item.total);

                            const row = worleySheet.addRow(rowData);
                            row.eachCell((cell) => {
                                cell.border = {
                                    top: { style: 'thin' },
                                    left: { style: 'thin' },
                                    bottom: { style: 'thin' },
                                    right: { style: 'thin' }
                                };
                            });
                        });

                        // Add Total row at bottom
                        const totalRowData = ['', '', 'Total'];
                        const worleyDailyTotals = {};
                        allDates.forEach(date => {
                            worleyDailyTotals[date] = 0;
                        });

                        worleyEntries.forEach(entry => {
                            if (worleyDailyTotals[entry.date] !== undefined) {
                                worleyDailyTotals[entry.date] += entry.hours;
                            }
                        });

                        let worleyGrandTotal = 0;
                        allDates.forEach(date => {
                            totalRowData.push(worleyDailyTotals[date]);
                            worleyGrandTotal += worleyDailyTotals[date];
                        });
                        totalRowData.push(worleyGrandTotal);

                        const totalRow = worleySheet.addRow(totalRowData);
                        totalRow.font = { bold: true };
                        totalRow.eachCell((cell) => {
                            cell.border = {
                                top: { style: 'thin' },
                                left: { style: 'thin' },
                                bottom: { style: 'thin' },
                                right: { style: 'thin' }
                            };
                        });

                        // Auto-fit columns in Worley sheet
                        worleySheet.columns.forEach((column) => {
                            let maxLength = 0;
                            column.eachCell({ includeEmpty: false }, (cell) => {
                                const cellValue = cell.value ? cell.value.toString() : '';
                                if (cellValue.length > maxLength) {
                                    maxLength = cellValue.length;
                                }
                            });
                            column.width = Math.min(Math.max(maxLength + 2, 12), 50);
                        });
                    }

                    // Generate file
                    const buffer = await workbook.xlsx.writeBuffer();
                    const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = "timesheet-" + (filterStartDate || 'all') + "-" + (filterEndDate || 'dates') + ".xlsx";
                    a.click();
                    window.URL.revokeObjectURL(url);

                } catch (error) {
                    console.error('Excel export error:', error);
                    setStorageError('Failed to export to Excel: ' + error.message);
                }
            };

            const getUniqueClients = () => {
                const clients = new Set(timeEntries.map(e => e.clientName));
                return Array.from(clients).sort();
            };

            const getUniqueProjects = () => {
                const projects = new Set(timeEntries.map(e => e.projectName));
                return Array.from(projects).sort();
            };

            // Helper functions for cascading dropdowns
            const getAvailableClients = () => {
                const clients = new Set(projectCodes.map(p => p.clientName));
                return Array.from(clients).sort();
            };

            const getAvailableProjectNames = (clientName) => {
                if (!clientName) return [];
                const projects = new Set(
                    projectCodes
                        .filter(p => p.clientName === clientName)
                        .map(p => p.projectName)
                );
                return Array.from(projects).sort();
            };

            const getAvailableTaskCodes = (clientName, projectName) => {
                if (!clientName || !projectName) return [];
                const tasks = new Set(
                    projectCodes
                        .filter(p => p.clientName === clientName && p.projectName === projectName)
                        .map(p => p.taskCode)
                );
                return Array.from(tasks).sort();
            };

            const getAvailableSubtaskCodes = (clientName, projectName, taskCode) => {
                if (!clientName || !projectName || !taskCode) return [];
                const subtasks = projectCodes
                    .filter(p =>
                        p.clientName === clientName &&
                        p.projectName === projectName &&
                        p.taskCode === taskCode
                    )
                    .map(p => ({
                        id: p.id,
                        subtaskCode: p.subtaskCode,
                        code: p.code
                    }));

                // Remove duplicates by keeping only unique subtask codes
                const uniqueSubtasks = [];
                const seenCodes = new Set();

                for (const subtask of subtasks) {
                    if (!seenCodes.has(subtask.code)) {
                        seenCodes.add(subtask.code);
                        uniqueSubtasks.push(subtask);
                    }
                }

                return uniqueSubtasks.sort((a, b) => a.subtaskCode.localeCompare(b.subtaskCode));
            };

            // Handle cascading dropdown selection
            const handleClientChange = (clientName) => {
                setSelectedClient(clientName);
                setSelectedProjectName('');
                setSelectedTaskCode('');
                setSelectedSubtaskCode('');
                setSelectedProject('');
            };

            const handleProjectNameChange = (projectName) => {
                setSelectedProjectName(projectName);
                setSelectedTaskCode('');
                setSelectedSubtaskCode('');
                setSelectedProject('');
            };

            const handleTaskCodeChange = (taskCode) => {
                setSelectedTaskCode(taskCode);
                setSelectedSubtaskCode('');
                setSelectedProject('');
            };

            const handleSubtaskCodeChange = (subtaskId) => {
                const subtask = projectCodes.find(p => p.id.toString() === subtaskId);
                if (subtask) {
                    setSelectedSubtaskCode(subtask.subtaskCode);
                    setSelectedProject(subtaskId);
                }
            };

            // Show license activation screen if not licensed
            if (!isLicensed) {
                if (checkingLicense) {
                    return React.createElement('div', { className: "min-h-screen bg-off-white flex items-center justify-center" },
                        React.createElement('div', { className: "text-center" },
                            React.createElement('div', { className: "text-xl text-eggplant mb-4" }, "Checking license..."),
                            React.createElement('div', { className: "text-gray-600" }, "Please wait")
                        )
                    );
                }

                return React.createElement('div', { className: "min-h-screen bg-off-white flex items-center justify-center px-4" },
                    React.createElement('div', { className: "bg-white rounded-lg shadow-xl p-8 max-w-md w-full border-t-4 border-deep-green" },
                        React.createElement('div', { className: "text-center mb-8" },
                            React.createElement('h1', { className: "text-3xl font-bold text-eggplant mb-2" }, "ThymeSheet"),
                            React.createElement('p', { className: "text-gray-600" }, "License Activation Required")
                        ),
                        React.createElement('div', { className: "mb-6" },
                            React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-2" }, "Enter your license key:"),
                            React.createElement('input', {
                                type: "text",
                                value: licenseKey,
                                onChange: (e) => setLicenseKey(e.target.value),
                                onKeyPress: (e) => e.key === 'Enter' && activateLicense(),
                                placeholder: "THYME-XXXX-XXXX-XXXX",
                                className: "w-full px-4 py-3 border-2 border-soft-gray rounded-lg focus:outline-none focus:border-deep-green text-center font-mono text-lg",
                                autoFocus: true
                            })
                        ),
                        licenseError && React.createElement('div', { className: "mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm" },
                            licenseError
                        ),
                        React.createElement('button', {
                            onClick: activateLicense,
                            className: "w-full bg-deep-green text-white py-3 px-6 rounded-lg font-semibold hover:opacity-90 transition-opacity"
                        }, "Activate License"),
                        React.createElement('div', { className: "mt-6 pt-6 border-t border-gray-200" },
                            React.createElement('p', { className: "text-xs text-gray-500 text-center mb-2" }, "This license key can only be used on one computer."),
                            React.createElement('p', { className: "text-xs text-gray-500 text-center" }, "Contact support if you need to transfer your license.")
                        )
                    )
                );
            }

            if (showSetup) {
                return React.createElement('div', { className: "min-h-screen" },
                    isTracking && currentSession && React.createElement('div', { className: "sticky top-0 z-50 mb-6 bg-white border-2 border-deep-green rounded-subtle shadow-md max-w-7xl mx-auto" },
                        React.createElement('div', { className: "p-3 flex items-center justify-between gap-4" },
                            React.createElement('div', { className: "flex items-center gap-3" },
                                React.createElement('div', { className: "w-2 h-2 bg-deep-green rounded-full animate-pulse" }),
                                React.createElement('div', { className: "text-xl font-mono font-semibold text-deep-green tabular-nums" }, formatTime(elapsedTime))
                            ),
                            React.createElement('div', { className: "flex-1 text-sm text-gray-700 truncate" },
                                React.createElement('span', { className: "font-semibold text-deep-green" }, currentSession.projectCode)
                            ),
                            React.createElement('div', { className: "flex items-center gap-2" },
                                React.createElement('select', {
                                    key: currentSession ? currentSession.projectId : 'no-session',
                                    value: "",
                                    onChange: (e) => {
                                        const value = e.target.value;
                                        console.log('Dropdown changed, value:', value);
                                        if (value && value !== "") {
                                            const projectId = parseInt(value);
                                            console.log('Switching to project ID:', projectId);
                                            if (!isNaN(projectId)) {
                                                switchProject(projectId);
                                            }
                                        }
                                    },
                                    className: "px-3 py-1.5 text-xs border border-soft-gray rounded-subtle bg-white text-gray-700 hover:border-deep-green focus:outline-none focus:border-deep-green transition-colors cursor-pointer"
                                },
                                    React.createElement('option', { value: "" }, "Switch to..."),
                                    (() => {
                                        const availableProjects = projectCodes.filter(p => p.id !== currentSession.projectId);
                                        const recentAvailable = recentProjects
                                            .filter(id => id !== currentSession.projectId)
                                            .map(id => availableProjects.find(p => p.id === id))
                                            .filter(p => p);
                                        const otherProjects = availableProjects.filter(p => !recentProjects.includes(p.id));

                                        let result = [];

                                        // Add recent projects with marker
                                        if (recentAvailable.length > 0) {
                                            result.push(React.createElement('option', { key: 'recent-header', disabled: true, style: { fontWeight: 'bold' } }, '── Recent Projects ──'));
                                            recentAvailable.slice(0, 9).forEach(project => {
                                                result.push(React.createElement('option', { key: project.id, value: project.id }, '⭐ ' + project.code));
                                            });
                                        }

                                        // Add separator and other projects
                                        if (otherProjects.length > 0) {
                                            if (recentAvailable.length > 0) {
                                                result.push(React.createElement('option', { key: 'other-header', disabled: true, style: { fontWeight: 'bold' } }, '── All Projects ──'));
                                            }
                                            otherProjects.forEach(project => {
                                                result.push(React.createElement('option', { key: project.id, value: project.id }, project.code));
                                            });
                                        }

                                        return result;
                                    })()
                                ),
                                React.createElement('button', {
                                    onClick: stopTracking,
                                    className: "flex items-center gap-1.5 px-3 py-1.5 bg-deep-green text-white rounded-subtle hover:bg-opacity-90 transition-all font-medium text-xs"
                                },
                                    React.createElement(Square, { size: 14 }),
                                    "Stop"
                                )
                            )
                        ),
                        React.createElement('div', { className: "px-3 pb-3 pt-0 border-t border-soft-gray" },
                            React.createElement('input', {
                                type: "text",
                                value: currentComment,
                                onChange: (e) => setCurrentComment(e.target.value),
                                placeholder: "Add comment (optional)...",
                                className: "w-full px-3 py-1.5 text-xs border border-soft-gray rounded-subtle focus:outline-none focus:border-deep-green bg-white text-gray-700"
                            })
                        )
                    ),
                    React.createElement('div', { className: "sticky top-0 z-40 bg-white border-b border-soft-gray shadow-sm mb-10" },
                        React.createElement('div', { className: "max-w-7xl mx-auto px-4 sm:px-8 flex flex-wrap justify-between items-center py-4 gap-4" },
                            React.createElement('div', { className: "bg-white rounded px-2 py-1 flex-shrink-0" },
                                React.createElement('img', {
                                    src: "logo.png",
                                    alt: "Timesheet Logo",
                                    className: "h-12 sm:h-16 w-auto"
                                })
                            ),
                            React.createElement('div', { className: "flex items-center gap-2 sm:gap-3 flex-wrap" },
                                React.createElement('button', {
                                    onClick: () => setShowFeedbackModal(true),
                                    className: "p-2 text-gray-500 hover:text-deep-green hover:bg-soft-gray rounded-full transition-all",
                                    title: "Send Feedback"
                                },
                                    React.createElement(MessageSquare)
                                ),
                                React.createElement('div', { className: "inline-flex bg-soft-gray rounded-full p-1" },
                                        React.createElement('button', {
                                            onClick: () => setShowSetup(false),
                                            className: "flex items-center gap-2 px-6 py-2 rounded-full transition-all font-medium " + (!showSetup ? "bg-deep-green text-white" : "text-gray-600 hover:text-gray-800")
                                        },
                                            React.createElement(Clock),
                                            "Track Time"
                                        ),
                                    React.createElement('button', {
                                        onClick: () => setShowSetup(true),
                                        className: "flex items-center gap-2 px-6 py-2 rounded-full transition-all font-medium " + (showSetup ? "bg-eggplant text-white" : "text-gray-600 hover:text-gray-800")
                                    },
                                        React.createElement(Building),
                                        "Manage Projects"
                                    )
                                )
                            )
                        )
                    ),
                    React.createElement('div', { className: "max-w-7xl mx-auto px-8 pb-8" },

                    showSettingsMenu && React.createElement('div', {
                        className: "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",
                        onClick: () => setShowSettingsMenu(false)
                    },
                        React.createElement('div', {
                            className: "bg-white rounded-subtle p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",
                            onClick: (e) => e.stopPropagation()
                        },
                            React.createElement('div', { className: "flex justify-between items-center mb-6" },
                                React.createElement('div', null,
                                    React.createElement('h2', { className: "text-2xl font-bold text-eggplant" }, "Settings"),
                                    React.createElement('p', { className: "text-xs text-gray-500 mt-1" }, "ThymeSheet v2.0.4")
                                ),
                                React.createElement('button', {
                                    onClick: () => setShowSettingsMenu(false),
                                    className: "text-gray-400 hover:text-eggplant text-2xl"
                                }, "×")
                            ),

                            React.createElement('div', { className: "space-y-6" },
                                React.createElement('div', { className: "border-b border-soft-gray pb-6" },
                                    React.createElement('h3', { className: "text-lg font-semibold text-eggplant mb-3" }, "Time Rounding"),
                                    React.createElement('p', { className: "text-sm text-gray-600 mb-3" }, "Automatically round up time entries for cleaner billing"),
                                    React.createElement('select', {
                                        value: timeRounding,
                                        onChange: (e) => setTimeRounding(e.target.value),
                                        className: "w-full px-4 py-2 border border-soft-gray rounded-subtle focus:outline-none focus:border-eggplant"
                                    },
                                        React.createElement('option', { value: "none" }, "No rounding"),
                                        React.createElement('option', { value: "5" }, "Round up to nearest 5 minutes"),
                                        React.createElement('option', { value: "10" }, "Round up to nearest 10 minutes"),
                                        React.createElement('option', { value: "15" }, "Round up to nearest 15 minutes")
                                    )
                                ),

                                React.createElement('div', { className: "border-b border-soft-gray pb-6" },
                                    React.createElement('div', { className: "flex items-center justify-between mb-3" },
                                        React.createElement('h3', { className: "text-lg font-semibold text-eggplant" }, "Auto-Pause Detection"),
                                        React.createElement('label', { className: "relative inline-flex items-center cursor-pointer" },
                                            React.createElement('input', {
                                                type: "checkbox",
                                                checked: autoPauseEnabled,
                                                onChange: (e) => setAutoPauseEnabled(e.target.checked),
                                                className: "sr-only peer"
                                            }),
                                            React.createElement('div', { className: "w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-deep-green" })
                                        )
                                    ),
                                    React.createElement('p', { className: "text-sm text-gray-600 mb-3" }, "Detect when computer is idle and prompt to stop timer"),
                                    autoPauseEnabled && React.createElement('select', {
                                        value: autoPauseMinutes,
                                        onChange: (e) => setAutoPauseMinutes(parseInt(e.target.value)),
                                        className: "w-full px-4 py-2 border border-soft-gray rounded-subtle focus:outline-none focus:border-eggplant"
                                    },
                                        React.createElement('option', { value: "5" }, "After 5 minutes idle"),
                                        React.createElement('option', { value: "10" }, "After 10 minutes idle"),
                                        React.createElement('option', { value: "15" }, "After 15 minutes idle"),
                                        React.createElement('option', { value: "30" }, "After 30 minutes idle")
                                    )
                                ),

                                React.createElement('div', { className: "border-b border-soft-gray pb-6" },
                                    React.createElement('div', { className: "flex items-center justify-between mb-3" },
                                        React.createElement('h3', { className: "text-lg font-semibold text-eggplant" }, "Daily Goal"),
                                        React.createElement('label', { className: "relative inline-flex items-center cursor-pointer" },
                                            React.createElement('input', {
                                                type: "checkbox",
                                                checked: dailyGoalEnabled,
                                                onChange: (e) => setDailyGoalEnabled(e.target.checked),
                                                className: "sr-only peer"
                                            }),
                                            React.createElement('div', { className: "w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-deep-green" })
                                        )
                                    ),
                                    React.createElement('p', { className: "text-sm text-gray-600 mb-3" }, "Set a daily hours target and track your progress"),
                                    dailyGoalEnabled && React.createElement('div', { className: "flex items-center gap-3" },
                                        React.createElement('input', {
                                            type: "number",
                                            min: "1",
                                            max: "24",
                                            value: dailyGoalHours,
                                            onChange: (e) => setDailyGoalHours(parseInt(e.target.value)),
                                            className: "w-20 px-4 py-2 border border-soft-gray rounded-subtle focus:outline-none focus:border-eggplant"
                                        }),
                                        React.createElement('span', { className: "text-gray-700" }, "hours per day")
                                    )
                                ),

                                React.createElement('div', { className: "border-t border-soft-gray pt-6 pb-6" },
                                    React.createElement('div', { className: "flex items-center justify-between mb-3" },
                                        React.createElement('h3', { className: "text-lg font-semibold text-eggplant" }, "Daily Progress"),
                                        React.createElement('label', { className: "relative inline-flex items-center cursor-pointer" },
                                            React.createElement('input', {
                                                type: "checkbox",
                                                checked: dailyProgressEnabled,
                                                onChange: (e) => setDailyProgressEnabled(e.target.checked),
                                                className: "sr-only peer"
                                            }),
                                            React.createElement('div', { className: "w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-deep-green" })
                                        )
                                    ),
                                    React.createElement('p', { className: "text-sm text-gray-600" }, "Show progress bar with hours worked today vs daily goal")
                                ),

                                React.createElement('div', { className: "border-t border-soft-gray pt-6 pb-6" },
                                    React.createElement('div', { className: "flex items-center justify-between mb-3" },
                                        React.createElement('h3', { className: "text-lg font-semibold text-eggplant" }, "Time Summary Widget"),
                                        React.createElement('label', { className: "relative inline-flex items-center cursor-pointer" },
                                            React.createElement('input', {
                                                type: "checkbox",
                                                checked: timeSummaryEnabled,
                                                onChange: (e) => setTimeSummaryEnabled(e.target.checked),
                                                className: "sr-only peer"
                                            }),
                                            React.createElement('div', { className: "w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-deep-green" })
                                        )
                                    ),
                                    React.createElement('p', { className: "text-sm text-gray-600" }, "Show daily, weekly, and monthly hour totals on Track Time page")
                                ),

                                React.createElement('div', { className: "border-t border-soft-gray pt-6 pb-6" },
                                    React.createElement('div', { className: "flex items-center justify-between mb-3" },
                                        React.createElement('h3', { className: "text-lg font-semibold text-eggplant" }, "Full Day Notification"),
                                        React.createElement('label', { className: "relative inline-flex items-center cursor-pointer" },
                                            React.createElement('input', {
                                                type: "checkbox",
                                                checked: fullDayNotificationEnabled,
                                                onChange: (e) => setFullDayNotificationEnabled(e.target.checked),
                                                className: "sr-only peer"
                                            }),
                                            React.createElement('div', { className: "w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-deep-green" })
                                        )
                                    ),
                                    React.createElement('p', { className: "text-sm text-gray-600" }, "Get notified after 8 hours of work to take a break")
                                ),

                                React.createElement('div', { className: "border-t border-soft-gray pt-6 pb-6" },
                                    React.createElement('div', { className: "flex items-center justify-between mb-3" },
                                        React.createElement('h3', { className: "text-lg font-semibold text-eggplant" }, "Hourly Break Reminder"),
                                        React.createElement('label', { className: "relative inline-flex items-center cursor-pointer" },
                                            React.createElement('input', {
                                                type: "checkbox",
                                                checked: hourlyBreakNotificationEnabled,
                                                onChange: (e) => setHourlyBreakNotificationEnabled(e.target.checked),
                                                className: "sr-only peer"
                                            }),
                                            React.createElement('div', { className: "w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-deep-green" })
                                        )
                                    ),
                                    React.createElement('p', { className: "text-sm text-gray-600" }, "Get reminded every hour to take a 5-minute break")
                                ),

                                React.createElement('div', { className: "pb-6" },
                                    React.createElement('div', { className: "flex items-center justify-between mb-3" },
                                        React.createElement('h3', { className: "text-lg font-semibold text-eggplant" }, "Floating Timer Window"),
                                        React.createElement('label', { className: "relative inline-flex items-center cursor-pointer" },
                                            React.createElement('input', {
                                                type: "checkbox",
                                                checked: floatingTimerEnabled,
                                                onChange: (e) => setFloatingTimerEnabled(e.target.checked),
                                                className: "sr-only peer"
                                            }),
                                            React.createElement('div', { className: "w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-deep-green" })
                                        )
                                    ),
                                    React.createElement('p', { className: "text-sm text-gray-600" }, "Show a small always-on-top window with timer while tracking")
                                )
                            )
                        )
                    ),

                    showFeedbackModal && React.createElement('div', {
                        className: "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",
                        onClick: () => setShowFeedbackModal(false)
                    },
                        React.createElement('div', {
                            className: "bg-white rounded-subtle p-8 max-w-lg w-full mx-4",
                            onClick: (e) => e.stopPropagation()
                        },
                            React.createElement('div', { className: "flex justify-between items-center mb-6" },
                                React.createElement('h2', { className: "text-2xl font-bold text-deep-green" }, "Send Feedback"),
                                React.createElement('button', {
                                    onClick: () => setShowFeedbackModal(false),
                                    className: "text-gray-400 hover:text-deep-green text-2xl"
                                }, "×")
                            ),
                            React.createElement('div', { className: "space-y-4" },
                                React.createElement('div', null,
                                    React.createElement('label', { className: "block text-sm font-semibold text-gray-700 mb-2" }, "What type of feedback?"),
                                    React.createElement('select', {
                                        value: feedbackType,
                                        onChange: (e) => setFeedbackType(e.target.value),
                                        className: "w-full px-4 py-2 border border-soft-gray rounded-subtle focus:outline-none focus:border-deep-green"
                                    },
                                        React.createElement('option', { value: "suggestion" }, "💡 Suggestion"),
                                        React.createElement('option', { value: "bug" }, "🐛 Bug Report"),
                                        React.createElement('option', { value: "feature" }, "✨ Feature Request"),
                                        React.createElement('option', { value: "other" }, "💬 Other")
                                    )
                                ),
                                React.createElement('div', null,
                                    React.createElement('label', { className: "block text-sm font-semibold text-gray-700 mb-2" }, "Your feedback"),
                                    React.createElement('textarea', {
                                        value: feedbackText,
                                        onChange: (e) => setFeedbackText(e.target.value),
                                        placeholder: "Tell us what you think...",
                                        rows: 6,
                                        className: "w-full px-4 py-2 border border-soft-gray rounded-subtle focus:outline-none focus:border-deep-green resize-none"
                                    })
                                ),
                                React.createElement('div', { className: "flex justify-end gap-3 pt-4" },
                                    React.createElement('button', {
                                        onClick: () => setShowFeedbackModal(false),
                                        className: "px-6 py-2 border border-soft-gray text-gray-700 rounded-subtle hover:bg-soft-gray transition-colors"
                                    }, "Cancel"),
                                    React.createElement('button', {
                                        onClick: () => {
                                            if (feedbackText.trim()) {
                                                const feedbackUrl = `https://docs.google.com/forms/d/e/1FAIpQLSeNFOTEUzh4y2cSDU9ndxzLFH066hQZRSZQOoGCSynuTuLI4w/viewform?usp=pp_url&entry.560510887=${encodeURIComponent(feedbackType)}&entry.1928926751=${encodeURIComponent(feedbackText)}`;
                                                require('electron').shell.openExternal(feedbackUrl);
                                                setFeedbackText('');
                                                setShowFeedbackModal(false);
                                                setActiveNotification({ type: 'success', message: 'Thank you for your feedback!' });
                                            }
                                        },
                                        disabled: !feedbackText.trim(),
                                        className: "px-6 py-2 bg-deep-green text-white rounded-subtle hover:bg-opacity-90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                                    }, "Send Feedback")
                                )
                            )
                        )
                    ),

                    showUpdateCheckModal && React.createElement('div', {
                        className: "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",
                        onClick: () => setShowUpdateCheckModal(false)
                    },
                        React.createElement('div', {
                            className: "bg-white rounded-subtle p-8 max-w-md w-full mx-4",
                            onClick: (e) => e.stopPropagation()
                        },
                            React.createElement('div', { className: "flex justify-between items-center mb-6" },
                                React.createElement('h2', { className: "text-2xl font-bold text-deep-green" }, "Check for Updates"),
                                React.createElement('button', {
                                    onClick: () => setShowUpdateCheckModal(false),
                                    className: "text-gray-400 hover:text-deep-green text-2xl"
                                }, "×")
                            ),
                            React.createElement('div', { className: "text-center py-4" },
                                React.createElement('p', { className: "text-gray-700" }, updateCheckMessage)
                            ),
                            React.createElement('div', { className: "flex justify-end pt-4" },
                                React.createElement('button', {
                                    onClick: () => setShowUpdateCheckModal(false),
                                    className: "px-6 py-2 bg-deep-green text-white rounded-subtle hover:bg-opacity-90 transition-colors"
                                }, "Close")
                            )
                        )
                    ),

                    showGuideModal && React.createElement('div', {
                        className: "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",
                        onClick: () => setShowGuideModal(false)
                    },
                        React.createElement('div', {
                            className: "bg-white rounded-subtle p-8 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",
                            onClick: (e) => e.stopPropagation()
                        },
                            React.createElement('div', { className: "flex justify-between items-center mb-6" },
                                React.createElement('h2', { className: "text-3xl font-bold text-eggplant" }, "Getting Started with ThymeSheet"),
                                React.createElement('button', {
                                    onClick: () => setShowGuideModal(false),
                                    className: "text-gray-400 hover:text-eggplant text-3xl leading-none"
                                }, "×")
                            ),

                            React.createElement('div', { className: "space-y-8" },
                                React.createElement('section', null,
                                    React.createElement('h3', { className: "text-xl font-semibold text-deep-green mb-4 flex items-center gap-2" },
                                        React.createElement('span', { className: "bg-deep-green text-white w-8 h-8 rounded-full flex items-center justify-center text-sm" }, "1"),
                                        "Setting Up Your Projects"
                                    ),
                                    React.createElement('div', { className: "ml-10 space-y-3 text-gray-700" },
                                        React.createElement('p', { className: "leading-relaxed" }, "Before you can track time, you need to add your projects. ThymeSheet uses a 4-field structure for maximum organization:"),
                                        React.createElement('ul', { className: "list-disc ml-6 space-y-2" },
                                            React.createElement('li', null, React.createElement('strong', null, "Client Name:"), " The company or organization you're working for (e.g., \"Orbital\")"),
                                            React.createElement('li', null, React.createElement('strong', null, "Project/Admin Name:"), " The specific project or administrative category (e.g., \"O2-X Habitat Offsetting Plan\")"),
                                            React.createElement('li', null, React.createElement('strong', null, "Task Code:"), " The main task category (e.g., \"1. Meetings and Delivery\")"),
                                            React.createElement('li', null, React.createElement('strong', null, "Subtask Code:"), " The specific subtask (e.g., \"1.1 Project\")")
                                        ),
                                        React.createElement('div', { className: "bg-pearl p-4 rounded-subtle mt-4" },
                                            React.createElement('p', { className: "font-semibold text-eggplant mb-2" }, "💡 Quick Tip:"),
                                            React.createElement('p', null, "Navigate to ", React.createElement('strong', null, "View → Manage Projects"), " or click the ", React.createElement('strong', null, "\"Manage Projects\""), " toggle to add projects one by one, or use ", React.createElement('strong', null, "\"Download Template\""), " to bulk import via CSV.")
                                        )
                                    )
                                ),

                                React.createElement('section', null,
                                    React.createElement('h3', { className: "text-xl font-semibold text-deep-green mb-4 flex items-center gap-2" },
                                        React.createElement('span', { className: "bg-deep-green text-white w-8 h-8 rounded-full flex items-center justify-center text-sm" }, "2"),
                                        "Tracking Your Time"
                                    ),
                                    React.createElement('div', { className: "ml-10 space-y-3 text-gray-700" },
                                        React.createElement('p', { className: "leading-relaxed" }, "Once your projects are set up, tracking time is simple:"),
                                        React.createElement('ol', { className: "list-decimal ml-6 space-y-2" },
                                            React.createElement('li', null, "Navigate to ", React.createElement('strong', null, "View → Track Time"), " or click the ", React.createElement('strong', null, "\"Track Time\""), " toggle"),
                                            React.createElement('li', null, "Select your project from the dropdown menu"),
                                            React.createElement('li', null, "Optionally add a comment describing what you're working on"),
                                            React.createElement('li', null, "Click ", React.createElement('strong', { className: "text-deep-green" }, "\"Start Timer\""), " to begin tracking"),
                                            React.createElement('li', null, "When you're done, click ", React.createElement('strong', { className: "text-eggplant" }, "\"Stop Timer\""), " to save the entry")
                                        ),
                                        React.createElement('div', { className: "bg-pearl p-4 rounded-subtle mt-4" },
                                            React.createElement('p', { className: "font-semibold text-eggplant mb-2" }, "⚡ Power Features:"),
                                            React.createElement('ul', { className: "list-disc ml-6 space-y-1" },
                                                React.createElement('li', null, React.createElement('strong', null, "Recent Projects:"), " Your last 5 projects appear at the top for quick access"),
                                                React.createElement('li', null, React.createElement('strong', null, "Quick Switch:"), " Use the dropdown in the running timer bar to switch projects without stopping"),
                                                React.createElement('li', null, React.createElement('strong', null, "Always Visible Timer:"), " The compact timer bar stays visible on both pages")
                                            )
                                        )
                                    )
                                ),

                                React.createElement('section', null,
                                    React.createElement('h3', { className: "text-xl font-semibold text-deep-green mb-4 flex items-center gap-2" },
                                        React.createElement('span', { className: "bg-deep-green text-white w-8 h-8 rounded-full flex items-center justify-center text-sm" }, "3"),
                                        "Keyboard Shortcuts"
                                    ),
                                    React.createElement('div', { className: "ml-10 space-y-3 text-gray-700" },
                                        React.createElement('p', { className: "leading-relaxed mb-3" }, "Work faster with these global hotkeys (work even when app is minimized):"),
                                        React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                                            React.createElement('div', { className: "flex items-center gap-3 bg-soft-gray p-3 rounded-subtle" },
                                                React.createElement('kbd', { className: "px-3 py-2 bg-white border-2 border-gray-300 rounded font-mono text-sm" }, "Ctrl+Shift+Z"),
                                                React.createElement('span', null, "Show/Hide window")
                                            ),
                                            React.createElement('div', { className: "flex items-center gap-3 bg-soft-gray p-3 rounded-subtle" },
                                                React.createElement('kbd', { className: "px-3 py-2 bg-white border-2 border-gray-300 rounded font-mono text-sm" }, "Ctrl+Shift+Space"),
                                                React.createElement('span', null, "Start/Stop timer")
                                            ),
                                            React.createElement('div', { className: "flex items-center gap-3 bg-soft-gray p-3 rounded-subtle" },
                                                React.createElement('kbd', { className: "px-3 py-2 bg-white border-2 border-gray-300 rounded font-mono text-sm" }, "Ctrl+,"),
                                                React.createElement('span', null, "Open Settings")
                                            ),
                                            React.createElement('div', { className: "flex items-center gap-3 bg-soft-gray p-3 rounded-subtle" },
                                                React.createElement('kbd', { className: "px-3 py-2 bg-white border-2 border-gray-300 rounded font-mono text-sm" }, "Ctrl+H"),
                                                React.createElement('span', null, "Hide to tray")
                                            )
                                        )
                                    )
                                ),

                                React.createElement('section', null,
                                    React.createElement('h3', { className: "text-xl font-semibold text-deep-green mb-4 flex items-center gap-2" },
                                        React.createElement('span', { className: "bg-deep-green text-white w-8 h-8 rounded-full flex items-center justify-center text-sm" }, "4"),
                                        "Configuring Settings"
                                    ),
                                    React.createElement('div', { className: "ml-10 space-y-3 text-gray-700" },
                                        React.createElement('p', { className: "leading-relaxed mb-3" }, "Access ", React.createElement('strong', null, "Settings → All Settings"), " from the menu to configure:"),
                                        React.createElement('div', { className: "space-y-3" },
                                            React.createElement('div', null,
                                                React.createElement('h4', { className: "font-semibold text-eggplant mb-1" }, "⏱️ Time Rounding"),
                                                React.createElement('p', null, "Automatically round up your time entries to 5, 10, or 15-minute intervals for cleaner billing. Perfect for hourly billing requirements.")
                                            ),
                                            React.createElement('div', null,
                                                React.createElement('h4', { className: "font-semibold text-eggplant mb-1" }, "⏸️ Auto-Pause Detection"),
                                                React.createElement('p', null, "ThymeSheet monitors mouse, keyboard, and click activity. If you're idle for your chosen duration (5-30 minutes), it asks if you want to stop the timer. Prevents accidental over-billing.")
                                            ),
                                            React.createElement('div', null,
                                                React.createElement('h4', { className: "font-semibold text-eggplant mb-1" }, "🎯 Daily Goal"),
                                                React.createElement('p', null, "Set a target number of hours per day. ThymeSheet shows a live progress bar with your current hours, percentage complete, and hours remaining. Motivating and informative!")
                                            )
                                        )
                                    )
                                ),

                                React.createElement('section', null,
                                    React.createElement('h3', { className: "text-xl font-semibold text-deep-green mb-4 flex items-center gap-2" },
                                        React.createElement('span', { className: "bg-deep-green text-white w-8 h-8 rounded-full flex items-center justify-center text-sm" }, "5"),
                                        "Exporting Your Data"
                                    ),
                                    React.createElement('div', { className: "ml-10 space-y-3 text-gray-700" },
                                        React.createElement('p', { className: "leading-relaxed" }, "ThymeSheet provides flexible export options for your timesheet data:"),
                                        React.createElement('div', { className: "space-y-3" },
                                            React.createElement('div', null,
                                                React.createElement('h4', { className: "font-semibold text-eggplant mb-1" }, "📊 CSV Export"),
                                                React.createElement('p', null, "Exports a detailed CSV with both a project summary and detailed entries. Filter by date range, client, or project before exporting.")
                                            ),
                                            React.createElement('div', null,
                                                React.createElement('h4', { className: "font-semibold text-eggplant mb-1" }, "💼 QuickBooks Online (QBO) Export"),
                                                React.createElement('p', null, "Exports in QBO-compatible format for easy import into QuickBooks. Includes service items, quantities, and customer mapping.")
                                            )
                                        ),
                                        React.createElement('div', { className: "bg-deep-green bg-opacity-10 border-l-4 border-deep-green p-4 rounded-subtle mt-4" },
                                            React.createElement('p', { className: "font-semibold text-deep-green mb-2" }, "📝 Pro Tip:"),
                                            React.createElement('p', null, "Use the date range filters to export specific billing periods. Comments are included in CSV exports, so add context to your time entries!")
                                        )
                                    )
                                ),

                                React.createElement('section', null,
                                    React.createElement('h3', { className: "text-xl font-semibold text-deep-green mb-4 flex items-center gap-2" },
                                        React.createElement('span', { className: "bg-deep-green text-white w-8 h-8 rounded-full flex items-center justify-center text-sm" }, "6"),
                                        "System Tray Integration"
                                    ),
                                    React.createElement('div', { className: "ml-10 space-y-3 text-gray-700" },
                                        React.createElement('p', { className: "leading-relaxed" }, "ThymeSheet lives in your system tray for always-available access:"),
                                        React.createElement('ul', { className: "list-disc ml-6 space-y-2" },
                                            React.createElement('li', null, React.createElement('strong', null, "Double-click the tray icon"), " to show/hide the window"),
                                            React.createElement('li', null, React.createElement('strong', null, "Right-click the tray icon"), " for quick actions:"),
                                            React.createElement('ul', { className: "list-circle ml-6 mt-1" },
                                                React.createElement('li', null, "Show ThymeSheet"),
                                                React.createElement('li', null, "Start/Stop Timer"),
                                                React.createElement('li', null, "Quit")
                                            ),
                                            React.createElement('li', null, "The app stays running in the tray even when you close the window, so you can quickly pop it back up with ", React.createElement('kbd', { className: "px-2 py-1 bg-soft-gray rounded text-sm" }, "Ctrl+Shift+Z"))
                                        )
                                    )
                                ),

                                React.createElement('section', { className: "border-t border-soft-gray pt-6" },
                                    React.createElement('h3', { className: "text-xl font-semibold text-eggplant mb-4" }, "💡 Best Practices"),
                                    React.createElement('div', { className: "space-y-2 text-gray-700" },
                                        React.createElement('ul', { className: "list-disc ml-6 space-y-2" },
                                            React.createElement('li', null, React.createElement('strong', null, "Set up all your projects at the start"), " to avoid interruptions during actual work"),
                                            React.createElement('li', null, React.createElement('strong', null, "Use descriptive comments"), " - your future self will thank you when reviewing entries"),
                                            React.createElement('li', null, React.createElement('strong', null, "Enable auto-pause"), " to prevent accidentally leaving the timer running"),
                                            React.createElement('li', null, React.createElement('strong', null, "Set a daily goal"), " to stay motivated and aware of your workload"),
                                            React.createElement('li', null, React.createElement('strong', null, "Export regularly"), " - weekly or bi-weekly exports make billing and invoicing smoother"),
                                            React.createElement('li', null, React.createElement('strong', null, "Use the Recent Projects"), " feature for recurring work - it saves valuable clicks!")
                                        )
                                    )
                                )
                            ),

                            React.createElement('div', { className: "mt-8 text-center" },
                                React.createElement('button', {
                                    onClick: () => setShowGuideModal(false),
                                    className: "px-8 py-3 bg-deep-green text-white rounded-subtle hover:bg-opacity-90 transition-all font-semibold"
                                }, "Got It!")
                            )
                        )
                    ),

                    storageError && React.createElement('div', { className: "mb-8 p-5 bg-white border-l-4 border-eggplant rounded-subtle shadow-sm" },
                        React.createElement('span', { className: "text-eggplant" }, storageError),
                        React.createElement('button', {
                            onClick: () => setStorageError(null),
                            className: "ml-3 text-eggplant hover:opacity-60 transition-opacity"
                        }, "×")
                    ),

                    React.createElement('div', { className: "bg-white border-l-4 border-deep-green rounded-subtle shadow-sm mb-8" },
                        React.createElement('div', {
                            className: "flex justify-between items-center p-4 cursor-pointer hover:bg-off-white transition-colors",
                            onClick: () => setShortcutsExpanded(!shortcutsExpanded)
                        },
                            React.createElement('h3', { className: "text-sm font-semibold text-eggplant uppercase tracking-wider" }, "Keyboard Shortcuts"),
                            React.createElement('div', {
                                className: "transform transition-transform " + (shortcutsExpanded ? "" : "rotate-180")
                            }, React.createElement(ChevronDown))
                        ),
                        shortcutsExpanded && React.createElement('div', { className: "px-4 pb-4 border-t border-soft-gray pt-4" },
                            React.createElement('div', { className: "space-y-4" },
                                React.createElement('div', null,
                                    React.createElement('h4', { className: "text-xs font-semibold text-deep-green mb-2 uppercase tracking-wide" }, "Global"),
                                    React.createElement('div', { className: "space-y-1 text-sm" },
                                        React.createElement('div', { className: "flex justify-between items-center py-1" },
                                            React.createElement('span', { className: "text-gray-600" }, "Show/Hide window"),
                                            React.createElement('kbd', { className: "px-2 py-1 bg-soft-gray border border-gray-300 rounded text-eggplant text-xs font-mono" }, "Ctrl+Shift+Z")
                                        ),
                                        React.createElement('div', { className: "flex justify-between items-center py-1" },
                                            React.createElement('span', { className: "text-gray-600" }, "Start/Stop timer"),
                                            React.createElement('kbd', { className: "px-2 py-1 bg-soft-gray border border-gray-300 rounded text-eggplant text-xs font-mono" }, "Ctrl+Shift+Space")
                                        )
                                    )
                                ),
                                React.createElement('div', null,
                                    React.createElement('h4', { className: "text-xs font-semibold text-deep-green mb-2 uppercase tracking-wide" }, "Track Time Page"),
                                    React.createElement('div', { className: "space-y-1 text-sm" },
                                        React.createElement('div', { className: "flex justify-between items-center py-1" },
                                            React.createElement('span', { className: "text-gray-600" }, "Quick select recent project"),
                                            React.createElement('kbd', { className: "px-2 py-1 bg-soft-gray border border-gray-300 rounded text-eggplant text-xs font-mono" }, "1-5")
                                        ),
                                        React.createElement('div', { className: "flex justify-between items-center py-1" },
                                            React.createElement('span', { className: "text-gray-600" }, "Start tracking"),
                                            React.createElement('kbd', { className: "px-2 py-1 bg-soft-gray border border-gray-300 rounded text-eggplant text-xs font-mono" }, "Enter")
                                        ),
                                        React.createElement('div', { className: "flex justify-between items-center py-1" },
                                            React.createElement('span', { className: "text-gray-600" }, "Pause/Resume timer"),
                                            React.createElement('kbd', { className: "px-2 py-1 bg-soft-gray border border-gray-300 rounded text-eggplant text-xs font-mono" }, "Space")
                                        ),
                                        React.createElement('div', { className: "flex justify-between items-center py-1" },
                                            React.createElement('span', { className: "text-gray-600" }, "Toggle between pages"),
                                            React.createElement('div', { className: "flex gap-1" },
                                                React.createElement('kbd', { className: "px-2 py-1 bg-soft-gray border border-gray-300 rounded text-eggplant text-xs font-mono" }, "←"),
                                                React.createElement('kbd', { className: "px-2 py-1 bg-soft-gray border border-gray-300 rounded text-eggplant text-xs font-mono" }, "→")
                                            )
                                        )
                                    )
                                )
                            )
                        )
                    ),
                    React.createElement('div', { className: "bg-white border-l-4 border-eggplant rounded-subtle p-10 mb-8 shadow-sm" },
                        React.createElement('h2', { className: "text-xl font-semibold text-eggplant mb-8" }, "Add a project and start tracking"),
                        React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8" },
                            React.createElement('div', null,
                                React.createElement('label', { className: "block text-sm font-medium text-eggplant mb-3" }, "Client Name"),
                                React.createElement('input', {
                                    type: "text",
                                    value: newClientName,
                                    onChange: (e) => setNewClientName(e.target.value),
                                    placeholder: "Orbital",
                                    className: "w-full px-4 py-3 border-b-2 border-soft-gray focus:outline-none focus:border-eggplant bg-transparent text-gray-800 transition-colors"
                                })
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { className: "block text-sm font-medium text-eggplant mb-3" }, "Project/Admin Name"),
                                React.createElement('input', {
                                    type: "text",
                                    value: newProjectName,
                                    onChange: (e) => setNewProjectName(e.target.value),
                                    placeholder: "O2-X Habitat Offsetting Plan",
                                    className: "w-full px-4 py-3 border-b-2 border-soft-gray focus:outline-none focus:border-eggplant bg-transparent text-gray-800 transition-colors"
                                })
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { className: "block text-sm font-medium text-eggplant mb-3" }, "Task Code"),
                                React.createElement('input', {
                                    type: "text",
                                    value: newTaskCode,
                                    onChange: (e) => setNewTaskCode(e.target.value.toUpperCase()),
                                    placeholder: "1. Meetings and Delivery",
                                    className: "w-full px-4 py-3 border-b-2 border-soft-gray focus:outline-none focus:border-eggplant bg-transparent text-gray-800 transition-colors"
                                })
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { className: "block text-sm font-medium text-eggplant mb-3" }, "Subtask Code"),
                                React.createElement('input', {
                                    type: "text",
                                    value: newSubtaskCode,
                                    onChange: (e) => setNewSubtaskCode(e.target.value.toUpperCase()),
                                    placeholder: "1.1 Project",
                                    className: "w-full px-4 py-3 border-b-2 border-soft-gray focus:outline-none focus:border-eggplant bg-transparent text-gray-800 transition-colors"
                                })
                            )
                        ),
                        React.createElement('div', { className: "flex gap-4" },
                            React.createElement('button', {
                                onClick: addProjectCode,
                                className: "flex items-center gap-2 px-6 py-3 bg-deep-green text-white rounded-subtle hover:bg-opacity-90 transition-all font-medium"
                            },
                                React.createElement(Plus),
                                "Add Project"
                            ),
                            React.createElement('button', {
                                onClick: addDemoData,
                                className: "px-6 py-3 border-2 border-eggplant text-eggplant rounded-subtle hover:bg-eggplant hover:text-white transition-all font-medium"
                            }, "Load Demo Data")
                        )
                    ),
                    React.createElement('div', { className: "flex items-center gap-4 mb-8" },
                        React.createElement('div', { className: "flex-1 h-px bg-soft-gray" }),
                        React.createElement('span', { className: "text-gray-500 text-sm uppercase tracking-wider" }, "or"),
                        React.createElement('div', { className: "flex-1 h-px bg-soft-gray" })
                    ),
                    React.createElement('div', { className: "bg-white border-l-4 border-deep-green rounded-subtle p-8 mb-8 shadow-sm" },
                        React.createElement('div', { className: "flex items-center gap-3 mb-6" },
                            React.createElement(Upload),
                            React.createElement('h3', { className: "text-xl font-semibold text-eggplant" }, "Bulk Import Projects from Spreadsheet")
                        ),
                        React.createElement('p', { className: "text-gray-700 mb-6 leading-relaxed" }, "Save time by importing multiple projects at once. Upload a CSV or Excel file with your project data."),

                        React.createElement('div', { className: "bg-soft-gray p-6 rounded-subtle mb-6" },
                            React.createElement('h4', { className: "font-semibold text-eggplant mb-3" }, "Required Format"),
                            React.createElement('p', { className: "text-sm text-gray-600 mb-4" }, "Your file must have exactly 4 columns in this order:"),
                            React.createElement('div', { className: "overflow-x-auto" },
                                React.createElement('table', { className: "w-full text-sm border-collapse" },
                                    React.createElement('thead', null,
                                        React.createElement('tr', { className: "bg-eggplant text-white" },
                                            React.createElement('th', { className: "px-4 py-2 text-left border border-gray-300" }, "Client Name"),
                                            React.createElement('th', { className: "px-4 py-2 text-left border border-gray-300" }, "Project/Admin Name"),
                                            React.createElement('th', { className: "px-4 py-2 text-left border border-gray-300" }, "Task Code"),
                                            React.createElement('th', { className: "px-4 py-2 text-left border border-gray-300" }, "Subtask Code")
                                        )
                                    ),
                                    React.createElement('tbody', null,
                                        React.createElement('tr', { className: "bg-white" },
                                            React.createElement('td', { className: "px-4 py-2 border border-gray-300" }, "Orbital"),
                                            React.createElement('td', { className: "px-4 py-2 border border-gray-300" }, "O2-X Habitat Offsetting Plan"),
                                            React.createElement('td', { className: "px-4 py-2 border border-gray-300" }, "1. Meetings and Delivery"),
                                            React.createElement('td', { className: "px-4 py-2 border border-gray-300" }, "1.1 Project")
                                        ),
                                        React.createElement('tr', { className: "bg-pearl" },
                                            React.createElement('td', { className: "px-4 py-2 border border-gray-300" }, "Orbital"),
                                            React.createElement('td', { className: "px-4 py-2 border border-gray-300" }, "O2-X Habitat Offsetting Plan"),
                                            React.createElement('td', { className: "px-4 py-2 border border-gray-300" }, "1. Meetings and Delivery"),
                                            React.createElement('td', { className: "px-4 py-2 border border-gray-300" }, "1.2 Internal")
                                        ),
                                        React.createElement('tr', { className: "bg-white" },
                                            React.createElement('td', { className: "px-4 py-2 border border-gray-300" }, "Orbital"),
                                            React.createElement('td', { className: "px-4 py-2 border border-gray-300" }, "O2-X Habitat Offsetting Plan"),
                                            React.createElement('td', { className: "px-4 py-2 border border-gray-300" }, "1. Meetings and Delivery"),
                                            React.createElement('td', { className: "px-4 py-2 border border-gray-300" }, "1.3 Regulatory")
                                        )
                                    )
                                )
                            )
                        ),

                        React.createElement('div', { className: "flex items-center gap-4 flex-wrap" },
                            React.createElement('button', {
                                onClick: browseCSVFile,
                                className: 'flex items-center gap-2 px-6 py-3 bg-deep-green text-white rounded-subtle hover:bg-opacity-90 transition-all font-medium'
                            },
                                React.createElement(FolderOpen),
                                "Browse File"
                            ),
                            React.createElement('button', {
                                onClick: downloadCSVTemplate,
                                className: 'flex items-center gap-2 px-6 py-3 border-2 border-deep-green text-deep-green rounded-subtle hover:bg-deep-green hover:text-white transition-all font-medium'
                            },
                                React.createElement(Download),
                                "Download Template"
                            )
                        ),
                        linkedCSVPath && React.createElement('div', { className: "mt-4 p-4 bg-soft-gray rounded-subtle" },
                            React.createElement('p', { className: "text-sm text-gray-700 mb-2" },
                                React.createElement('strong', null, "Linked File: "),
                                linkedCSVPath
                            ),
                            React.createElement('button', {
                                onClick: refreshFromCSV,
                                className: 'flex items-center gap-2 px-4 py-2 bg-eggplant text-white rounded-subtle hover:bg-opacity-90 transition-all font-medium text-sm'
                            },
                                React.createElement(RefreshCw),
                                "Refresh Projects from File"
                            )
                        )
                    ),
                    projectCodes.length > 0 && React.createElement('div', { className: "mb-8" },
                        React.createElement('div', { className: "flex items-center justify-between mb-6" },
                            React.createElement('h2', { className: "text-xl font-semibold text-eggplant" }, "Your Projects")
                        ),
                        React.createElement('div', { className: "mb-5" },
                            React.createElement('div', { className: "relative" },
                                React.createElement('input', {
                                    type: 'text',
                                    value: projectSearchTerm,
                                    onChange: (e) => setProjectSearchTerm(e.target.value),
                                    placeholder: 'Search by client, project, or code...',
                                    className: 'w-full px-4 py-3 border border-soft-gray rounded-subtle focus:outline-none focus:border-eggplant bg-white text-gray-800 transition-colors'
                                }),
                                projectSearchTerm && React.createElement('button', {
                                    onClick: () => setProjectSearchTerm(''),
                                    className: 'absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-eggplant text-xl'
                                }, '×')
                            )
                        ),
                        React.createElement('div', { className: "space-y-3" },
                            Object.entries(organizeProjectsByHierarchy()).map(([clientName, clientProjects]) =>
                                React.createElement('div', { key: clientName, className: "bg-white border border-soft-gray rounded-subtle overflow-hidden" },
                                    React.createElement('div', { className: "flex items-center" },
                                        React.createElement('button', {
                                            onClick: () => toggleClient(clientName),
                                            className: "flex-1 flex items-center justify-between p-4 bg-pearl hover:bg-opacity-70 transition-colors text-left"
                                        },
                                            React.createElement('div', { className: "flex items-center gap-2" },
                                                React.createElement(Building),
                                                React.createElement('span', { className: "font-semibold text-eggplant" }, clientName)
                                            ),
                                            React.createElement('div', { className: "flex items-center gap-3" },
                                                React.createElement('span', { className: "text-sm text-gray-600" },
                                                    Object.keys(clientProjects).length + " project" + (Object.keys(clientProjects).length !== 1 ? 's' : '')
                                                ),
                                                React.createElement('span', { className: "text-sm text-eggplant" },
                                                    expandedClients[clientName] ? '▼' : '▶'
                                                )
                                            )
                                        ),
                                        React.createElement('button', {
                                            onClick: (e) => {
                                                e.stopPropagation();
                                                deleteAllByClient(clientName);
                                            },
                                            className: "p-4 text-gray-400 hover:text-eggplant transition-colors",
                                            title: "Delete all projects for this client"
                                        }, React.createElement(Trash2))
                                    ),
                                    expandedClients[clientName] && React.createElement('div', { className: "p-2 bg-white space-y-2" },
                                        Object.entries(clientProjects).map(([projectName, projectTasks]) =>
                                            React.createElement('div', { key: clientName + "-" + projectName, className: "border border-soft-gray rounded-subtle overflow-hidden" },
                                                React.createElement('div', { className: "flex items-center" },
                                                    React.createElement('button', {
                                                        onClick: () => toggleProject(clientName, projectName),
                                                        className: "flex-1 flex items-center justify-between p-3 bg-off-white hover:bg-soft-gray transition-colors text-left"
                                                    },
                                                        React.createElement('div', { className: "flex items-center gap-2" },
                                                            React.createElement(Folder),
                                                            React.createElement('span', { className: "font-medium text-deep-green" }, projectName)
                                                        ),
                                                        React.createElement('div', { className: "flex items-center gap-2" },
                                                            React.createElement('span', { className: "text-sm text-gray-600" },
                                                                Object.keys(projectTasks).length + " task" + (Object.keys(projectTasks).length !== 1 ? 's' : '')
                                                            ),
                                                            React.createElement('span', { className: "text-sm text-deep-green" },
                                                                expandedProjects[clientName + "::" + projectName] ? '▼' : '▶'
                                                            )
                                                        )
                                                    ),
                                                    React.createElement('button', {
                                                        onClick: (e) => {
                                                            e.stopPropagation();
                                                            deleteAllByProject(clientName, projectName);
                                                        },
                                                        className: "p-3 text-gray-400 hover:text-deep-green transition-colors",
                                                        title: "Delete all codes for this project"
                                                    }, React.createElement(Trash2))
                                                ),
                                                expandedProjects[clientName + "::" + projectName] && React.createElement('div', { className: "p-2 bg-white space-y-2" },
                                                    Object.entries(projectTasks).map(([taskCode, subtasks]) =>
                                                        React.createElement('div', { key: clientName + "-" + projectName + "-" + taskCode, className: "border border-soft-gray rounded-subtle overflow-hidden" },
                                                            React.createElement('button', {
                                                                onClick: () => toggleTask(clientName, projectName, taskCode),
                                                                className: "w-full flex items-center justify-between p-3 bg-pearl hover:bg-opacity-70 transition-colors text-left"
                                                            },
                                                                React.createElement('div', { className: "flex items-center gap-2" },
                                                                    React.createElement(Tag),
                                                                    React.createElement('span', { className: "font-medium text-eggplant" }, 'Task: ' + taskCode)
                                                                ),
                                                                React.createElement('div', { className: "flex items-center gap-2" },
                                                                    React.createElement('span', { className: "text-sm text-gray-600" },
                                                                        subtasks.length + " subtask" + (subtasks.length !== 1 ? 's' : '')
                                                                    ),
                                                                    React.createElement('span', { className: "text-sm text-eggplant" },
                                                                        expandedTasks[clientName + "::" + projectName + "::" + taskCode] ? '▼' : '▶'
                                                                    )
                                                                )
                                                            ),
                                                            expandedTasks[clientName + "::" + projectName + "::" + taskCode] && React.createElement('div', { className: "space-y-1 p-2 bg-white" },
                                                                subtasks.map((project) =>
                                                                    React.createElement('div', {
                                                                        key: project.id,
                                                                        className: 'flex items-center justify-between p-3 bg-off-white border-l-4 border-transparent rounded-subtle'
                                                                    },
                                                                        React.createElement('div', { className: "flex-1" },
                                                                            React.createElement('div', { className: "flex items-center gap-2" },
                                                                                React.createElement(Bookmark),
                                                                                React.createElement('span', { className: "font-semibold text-deep-green" }, project.subtaskCode),
                                                                                React.createElement('span', { className: "text-xs px-2 py-0.5 bg-soft-gray text-gray-600 rounded" }, project.code)
                                                                            )
                                                                        ),
                                                                        React.createElement('button', {
                                                                            onClick: () => deleteProjectCode(project.id),
                                                                            className: "text-gray-400 hover:text-eggplant transition-colors ml-3"
                                                                        }, React.createElement(Trash2))
                                                                    )
                                                                )
                                                            )
                                                        )
                                                    )
                                                )
                                            )
                                        )
                                    )
                                )
                            )
                        )
                    ),
                    projectCodes.length > 0 && React.createElement('div', { className: "text-center pt-6" },
                        React.createElement('button', {
                            onClick: () => setShowSetup(false),
                            className: "px-10 py-4 bg-deep-green text-white text-base font-semibold rounded-subtle hover:bg-opacity-90 transition-all shadow-md"
                        }, "Start Tracking")
                    )
                    ),
                    // Notification Toast for Manage Projects page
                    activeNotification && React.createElement('div', {
                        className: "fixed bottom-4 right-4 z-50"
                    },
                        React.createElement('div', {
                            className: "bg-white border-l-4 rounded-subtle shadow-xl p-4 max-w-sm flex items-start gap-3 " + (activeNotification.type === 'success' ? "border-deep-green" : "border-eggplant")
                        },
                            React.createElement('div', { className: "flex-1" },
                                React.createElement('p', { className: "text-sm text-gray-800" }, activeNotification.message)
                            ),
                            React.createElement('button', {
                                onClick: () => setActiveNotification(null),
                                className: "text-gray-400 hover:text-gray-600 transition-colors text-xl leading-none"
                            }, "×")
                        )
                    )
                );
            }

            return React.createElement('div', { className: "min-h-screen" },
                // Update notification banner
                (updateAvailable || updateDownloaded) && React.createElement('div', {
                    className: "sticky top-0 z-50 mb-6 bg-blue-50 border-2 border-blue-400 rounded-subtle shadow-md max-w-7xl mx-auto"
                },
                    React.createElement('div', { className: "p-4 flex items-center justify-between gap-4" },
                        React.createElement('div', { className: "flex items-center gap-3" },
                            React.createElement(Download),
                            React.createElement('div', null,
                                React.createElement('div', { className: "text-sm font-semibold text-blue-900" },
                                    updateDownloaded ? 'Update Ready to Install' : 'Update Available'
                                ),
                                React.createElement('div', { className: "text-xs text-blue-700" },
                                    updateDownloaded
                                        ? 'A new version has been downloaded and is ready to install. Click "Restart & Update" to update.'
                                        : updateInfo ? `Version ${updateInfo.version} is available. Click "Download" to update.` : 'A new version is available.'
                                ),
                                isDownloading && downloadProgress > 0 && React.createElement('div', { className: "mt-2" },
                                    React.createElement('div', { className: "w-64 bg-gray-200 rounded-full h-2" },
                                        React.createElement('div', {
                                            className: "bg-blue-600 h-2 rounded-full transition-all",
                                            style: { width: `${downloadProgress}%` }
                                        })
                                    ),
                                    React.createElement('div', { className: "text-xs text-blue-600 mt-1" },
                                        `Downloading... ${Math.round(downloadProgress)}%`
                                    )
                                )
                            )
                        ),
                        React.createElement('div', { className: "flex items-center gap-2" },
                            !updateDownloaded && !isDownloading && React.createElement('button', {
                                onClick: handleDownloadUpdate,
                                className: "px-4 py-2 text-sm bg-blue-600 text-white rounded-subtle hover:bg-blue-700 transition-colors font-medium"
                            }, "Download Update"),
                            updateDownloaded && React.createElement('button', {
                                onClick: handleInstallUpdate,
                                className: "px-4 py-2 text-sm bg-blue-600 text-white rounded-subtle hover:bg-blue-700 transition-colors font-medium"
                            }, "Restart & Update"),
                            React.createElement('button', {
                                onClick: handleDismissUpdate,
                                className: "px-3 py-2 text-sm border border-blue-300 text-blue-700 rounded-subtle hover:bg-blue-100 transition-colors"
                            }, "Later")
                        )
                    )
                ),
                isTracking && currentSession && React.createElement('div', { className: "sticky top-0 z-50 mb-6 bg-white border-2 border-deep-green rounded-subtle shadow-md max-w-7xl mx-auto" },
                    React.createElement('div', { className: "p-3 flex items-center justify-between gap-4" },
                        React.createElement('div', { className: "flex items-center gap-3" },
                            React.createElement('div', { className: "w-2 h-2 bg-deep-green rounded-full animate-pulse" }),
                            React.createElement('div', { className: "text-xl font-mono font-semibold text-deep-green tabular-nums" }, formatTime(elapsedTime))
                        ),
                        React.createElement('div', { className: "flex-1 text-sm text-gray-700 truncate" },
                            React.createElement('span', { className: "font-semibold text-deep-green" }, currentSession.projectCode)
                        ),
                        React.createElement('div', { className: "flex items-center gap-2" },
                            React.createElement('select', {
                                key: currentSession ? currentSession.projectId : 'no-session',
                                value: "",
                                onChange: (e) => {
                                    const value = e.target.value;
                                    console.log('Dropdown changed, value:', value);
                                    if (value && value !== "") {
                                        const projectId = parseInt(value);
                                        console.log('Switching to project ID:', projectId);
                                        if (!isNaN(projectId)) {
                                            switchProject(projectId);
                                        }
                                    }
                                },
                                className: "px-3 py-1.5 text-xs border border-soft-gray rounded-subtle bg-white text-gray-700 hover:border-deep-green focus:outline-none focus:border-deep-green transition-colors cursor-pointer"
                            },
                                React.createElement('option', { value: "" }, "Switch to..."),
                                (() => {
                                    const availableProjects = projectCodes.filter(p => p.id !== currentSession.projectId);
                                    const recentAvailable = recentProjects
                                        .filter(id => id !== currentSession.projectId)
                                        .map(id => availableProjects.find(p => p.id === id))
                                        .filter(p => p);
                                    const otherProjects = availableProjects.filter(p => !recentProjects.includes(p.id));

                                    let result = [];

                                    // Add recent projects with marker
                                    if (recentAvailable.length > 0) {
                                        result.push(React.createElement('option', { key: 'recent-header', disabled: true, style: { fontWeight: 'bold' } }, '── Recent Projects ──'));
                                        recentAvailable.slice(0, 9).forEach(project => {
                                            result.push(React.createElement('option', { key: project.id, value: project.id }, '⭐ ' + project.code));
                                        });
                                    }

                                    // Add separator and other projects
                                    if (otherProjects.length > 0) {
                                        if (recentAvailable.length > 0) {
                                            result.push(React.createElement('option', { key: 'other-header', disabled: true, style: { fontWeight: 'bold' } }, '── All Projects ──'));
                                        }
                                        otherProjects.forEach(project => {
                                            result.push(React.createElement('option', { key: project.id, value: project.id }, project.code));
                                        });
                                    }

                                    return result;
                                })()
                            ),
                            React.createElement('button', {
                                onClick: stopTracking,
                                className: "flex items-center gap-1.5 px-3 py-1.5 bg-deep-green text-white rounded-subtle hover:bg-opacity-90 transition-all font-medium text-xs"
                            },
                                React.createElement(Square, { size: 14 }),
                                "Stop"
                            )
                        )
                    ),
                    React.createElement('div', { className: "px-3 pb-3 pt-0 border-t border-soft-gray" },
                        React.createElement('input', {
                            type: "text",
                            value: currentComment,
                            onChange: (e) => setCurrentComment(e.target.value),
                            placeholder: "Add comment (optional)...",
                            className: "w-full px-3 py-1.5 text-xs border border-soft-gray rounded-subtle focus:outline-none focus:border-deep-green bg-white text-gray-700"
                        })
                    )
                ),
                React.createElement('div', { className: "sticky top-0 z-40 bg-white border-b border-soft-gray shadow-sm mb-10" },
                    React.createElement('div', { className: "max-w-7xl mx-auto px-4 sm:px-8 flex flex-wrap justify-between items-center py-4 gap-4" },
                        React.createElement('div', { className: "bg-white rounded px-2 py-1 flex-shrink-0" },
                            React.createElement('img', {
                                src: "logo.png",
                                alt: "Timesheet Logo",
                                className: "h-12 sm:h-16 w-auto"
                            })
                        ),
                        React.createElement('div', { className: "flex items-center gap-2 sm:gap-3 flex-wrap" },
                            React.createElement('button', {
                                onClick: () => setShowFeedbackModal(true),
                                className: "p-2 text-gray-500 hover:text-deep-green hover:bg-soft-gray rounded-full transition-all",
                                title: "Send Feedback"
                            },
                                React.createElement(MessageSquare)
                            ),
                            React.createElement('div', { className: "inline-flex bg-soft-gray rounded-full p-1" },
                                React.createElement('button', {
                                    onClick: () => setShowSetup(false),
                                    className: "flex items-center gap-2 px-6 py-2 rounded-full transition-all font-medium " + (!showSetup ? "bg-deep-green text-white" : "text-gray-600 hover:text-gray-800")
                                },
                                    React.createElement(Clock),
                                    "Track Time"
                                ),
                                React.createElement('button', {
                                    onClick: () => setShowSetup(true),
                                    className: "flex items-center gap-2 px-6 py-2 rounded-full transition-all font-medium " + (showSetup ? "bg-eggplant text-white" : "text-gray-600 hover:text-gray-800")
                                },
                                    React.createElement(Building),
                                    "Manage Projects"
                                )
                            )
                        )
                    )
                ),
                React.createElement('div', { className: "max-w-7xl mx-auto px-8 pb-8" },

                showSettingsMenu && React.createElement('div', {
                    className: "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",
                    onClick: () => setShowSettingsMenu(false)
                },
                    React.createElement('div', {
                        className: "bg-white rounded-subtle p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",
                        onClick: (e) => e.stopPropagation()
                    },
                        React.createElement('div', { className: "flex justify-between items-center mb-6" },
                            React.createElement('div', null,
                                React.createElement('h2', { className: "text-2xl font-bold text-eggplant" }, "Settings"),
                                React.createElement('p', { className: "text-xs text-gray-500 mt-1" }, "ThymeSheet v2.0.3")
                            ),
                            React.createElement('button', {
                                onClick: () => setShowSettingsMenu(false),
                                className: "text-gray-400 hover:text-eggplant text-2xl"
                            }, "×")
                        ),

                        React.createElement('div', { className: "space-y-6" },
                            React.createElement('div', { className: "border-b border-soft-gray pb-6" },
                                React.createElement('h3', { className: "text-lg font-semibold text-eggplant mb-3" }, "Time Rounding"),
                                React.createElement('p', { className: "text-sm text-gray-600 mb-3" }, "Automatically round up time entries for cleaner billing"),
                                React.createElement('select', {
                                    value: timeRounding,
                                    onChange: (e) => setTimeRounding(e.target.value),
                                    className: "w-full px-4 py-2 border border-soft-gray rounded-subtle focus:outline-none focus:border-eggplant"
                                },
                                    React.createElement('option', { value: "none" }, "No rounding"),
                                    React.createElement('option', { value: "5" }, "Round up to nearest 5 minutes"),
                                    React.createElement('option', { value: "10" }, "Round up to nearest 10 minutes"),
                                    React.createElement('option', { value: "15" }, "Round up to nearest 15 minutes")
                                )
                            ),

                            React.createElement('div', { className: "border-b border-soft-gray pb-6" },
                                React.createElement('div', { className: "flex items-center justify-between mb-3" },
                                    React.createElement('h3', { className: "text-lg font-semibold text-eggplant" }, "Auto-Pause Detection"),
                                    React.createElement('label', { className: "relative inline-flex items-center cursor-pointer" },
                                        React.createElement('input', {
                                            type: "checkbox",
                                            checked: autoPauseEnabled,
                                            onChange: (e) => setAutoPauseEnabled(e.target.checked),
                                            className: "sr-only peer"
                                        }),
                                        React.createElement('div', { className: "w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-deep-green" })
                                    )
                                ),
                                React.createElement('p', { className: "text-sm text-gray-600 mb-3" }, "Detect when computer is idle and prompt to stop timer"),
                                autoPauseEnabled && React.createElement('select', {
                                    value: autoPauseMinutes,
                                    onChange: (e) => setAutoPauseMinutes(parseInt(e.target.value)),
                                    className: "w-full px-4 py-2 border border-soft-gray rounded-subtle focus:outline-none focus:border-eggplant"
                                },
                                    React.createElement('option', { value: "5" }, "After 5 minutes idle"),
                                    React.createElement('option', { value: "10" }, "After 10 minutes idle"),
                                    React.createElement('option', { value: "15" }, "After 15 minutes idle"),
                                    React.createElement('option', { value: "30" }, "After 30 minutes idle")
                                )
                            ),

                            React.createElement('div', { className: "border-b border-soft-gray pb-6" },
                                React.createElement('div', { className: "flex items-center justify-between mb-3" },
                                    React.createElement('h3', { className: "text-lg font-semibold text-eggplant" }, "Daily Goal"),
                                    React.createElement('label', { className: "relative inline-flex items-center cursor-pointer" },
                                        React.createElement('input', {
                                            type: "checkbox",
                                            checked: dailyGoalEnabled,
                                            onChange: (e) => setDailyGoalEnabled(e.target.checked),
                                            className: "sr-only peer"
                                        }),
                                        React.createElement('div', { className: "w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-deep-green" })
                                    )
                                ),
                                React.createElement('p', { className: "text-sm text-gray-600 mb-3" }, "Set a daily hours target and track your progress"),
                                dailyGoalEnabled && React.createElement('div', { className: "flex items-center gap-3" },
                                    React.createElement('input', {
                                        type: "number",
                                        min: "1",
                                        max: "24",
                                        value: dailyGoalHours,
                                        onChange: (e) => setDailyGoalHours(parseInt(e.target.value)),
                                        className: "w-20 px-4 py-2 border border-soft-gray rounded-subtle focus:outline-none focus:border-eggplant"
                                    }),
                                    React.createElement('span', { className: "text-gray-700" }, "hours per day")
                                )
                            ),

                            React.createElement('div', { className: "border-t border-soft-gray pt-6 pb-6" },
                                React.createElement('div', { className: "flex items-center justify-between mb-3" },
                                    React.createElement('h3', { className: "text-lg font-semibold text-eggplant" }, "Daily Progress"),
                                    React.createElement('label', { className: "relative inline-flex items-center cursor-pointer" },
                                        React.createElement('input', {
                                            type: "checkbox",
                                            checked: dailyProgressEnabled,
                                            onChange: (e) => setDailyProgressEnabled(e.target.checked),
                                            className: "sr-only peer"
                                        }),
                                        React.createElement('div', { className: "w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-deep-green" })
                                    )
                                ),
                                React.createElement('p', { className: "text-sm text-gray-600" }, "Show progress bar with hours worked today vs daily goal")
                            ),

                            React.createElement('div', { className: "border-t border-soft-gray pt-6 pb-6" },
                                React.createElement('div', { className: "flex items-center justify-between mb-3" },
                                    React.createElement('h3', { className: "text-lg font-semibold text-eggplant" }, "Time Summary Widget"),
                                    React.createElement('label', { className: "relative inline-flex items-center cursor-pointer" },
                                        React.createElement('input', {
                                            type: "checkbox",
                                            checked: timeSummaryEnabled,
                                            onChange: (e) => setTimeSummaryEnabled(e.target.checked),
                                            className: "sr-only peer"
                                        }),
                                        React.createElement('div', { className: "w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-deep-green" })
                                    )
                                ),
                                React.createElement('p', { className: "text-sm text-gray-600" }, "Show daily, weekly, and monthly hour totals on Track Time page")
                            ),

                            React.createElement('div', { className: "border-t border-soft-gray pt-6 pb-6" },
                                React.createElement('div', { className: "flex items-center justify-between mb-3" },
                                    React.createElement('h3', { className: "text-lg font-semibold text-eggplant" }, "Full Day Notification"),
                                    React.createElement('label', { className: "relative inline-flex items-center cursor-pointer" },
                                        React.createElement('input', {
                                            type: "checkbox",
                                            checked: fullDayNotificationEnabled,
                                            onChange: (e) => setFullDayNotificationEnabled(e.target.checked),
                                            className: "sr-only peer"
                                        }),
                                        React.createElement('div', { className: "w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-deep-green" })
                                    )
                                ),
                                React.createElement('p', { className: "text-sm text-gray-600" }, "Get notified after 8 hours of work to take a break")
                            ),

                            React.createElement('div', { className: "border-t border-soft-gray pt-6 pb-6" },
                                React.createElement('div', { className: "flex items-center justify-between mb-3" },
                                    React.createElement('h3', { className: "text-lg font-semibold text-eggplant" }, "Hourly Break Reminder"),
                                    React.createElement('label', { className: "relative inline-flex items-center cursor-pointer" },
                                        React.createElement('input', {
                                            type: "checkbox",
                                            checked: hourlyBreakNotificationEnabled,
                                            onChange: (e) => setHourlyBreakNotificationEnabled(e.target.checked),
                                            className: "sr-only peer"
                                        }),
                                        React.createElement('div', { className: "w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-deep-green" })
                                    )
                                ),
                                React.createElement('p', { className: "text-sm text-gray-600" }, "Get reminded every hour to take a 5-minute break")
                            ),

                            React.createElement('div', { className: "pb-6" },
                                React.createElement('div', { className: "flex items-center justify-between mb-3" },
                                    React.createElement('h3', { className: "text-lg font-semibold text-eggplant" }, "Floating Timer Window"),
                                    React.createElement('label', { className: "relative inline-flex items-center cursor-pointer" },
                                        React.createElement('input', {
                                            type: "checkbox",
                                            checked: floatingTimerEnabled,
                                            onChange: (e) => setFloatingTimerEnabled(e.target.checked),
                                            className: "sr-only peer"
                                        }),
                                        React.createElement('div', { className: "w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-deep-green" })
                                    )
                                ),
                                React.createElement('p', { className: "text-sm text-gray-600" }, "Show a small always-on-top window with timer while tracking")
                            )
                        )
                    )
                ),

                showGuideModal && React.createElement('div', {
                    className: "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",
                    onClick: () => setShowGuideModal(false)
                },
                    React.createElement('div', {
                        className: "bg-white rounded-subtle p-8 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",
                        onClick: (e) => e.stopPropagation()
                    },
                        React.createElement('div', { className: "flex justify-between items-center mb-6" },
                            React.createElement('h2', { className: "text-3xl font-bold text-eggplant" }, "Getting Started with ThymeSheet"),
                            React.createElement('button', {
                                onClick: () => setShowGuideModal(false),
                                className: "text-gray-400 hover:text-eggplant text-3xl leading-none"
                            }, "×")
                        ),

                        React.createElement('div', { className: "space-y-8" },
                            React.createElement('section', null,
                                React.createElement('h3', { className: "text-xl font-semibold text-deep-green mb-4 flex items-center gap-2" },
                                    React.createElement('span', { className: "bg-deep-green text-white w-8 h-8 rounded-full flex items-center justify-center text-sm" }, "1"),
                                    "Setting Up Your Projects"
                                ),
                                React.createElement('div', { className: "ml-10 space-y-3 text-gray-700" },
                                    React.createElement('p', { className: "leading-relaxed" }, "Before you can track time, you need to add your projects. ThymeSheet uses a 4-field structure for maximum organization:"),
                                    React.createElement('ul', { className: "list-disc ml-6 space-y-2" },
                                        React.createElement('li', null, React.createElement('strong', null, "Client Name:"), " The company or organization you're working for (e.g., \"Orbital\")"),
                                        React.createElement('li', null, React.createElement('strong', null, "Project/Admin Name:"), " The specific project or administrative category (e.g., \"O2-X Habitat Offsetting Plan\")"),
                                        React.createElement('li', null, React.createElement('strong', null, "Task Code:"), " The main task category (e.g., \"1. Meetings and Delivery\")"),
                                        React.createElement('li', null, React.createElement('strong', null, "Subtask Code:"), " The specific subtask (e.g., \"1.1 Project\")")
                                    ),
                                    React.createElement('div', { className: "bg-pearl p-4 rounded-subtle mt-4" },
                                        React.createElement('p', { className: "font-semibold text-eggplant mb-2" }, "💡 Quick Tip:"),
                                        React.createElement('p', null, "Navigate to ", React.createElement('strong', null, "View → Manage Projects"), " or click the ", React.createElement('strong', null, "\"Manage Projects\""), " toggle to add projects one by one, or use ", React.createElement('strong', null, "\"Download Template\""), " to bulk import via CSV.")
                                    )
                                )
                            ),

                            React.createElement('section', null,
                                React.createElement('h3', { className: "text-xl font-semibold text-deep-green mb-4 flex items-center gap-2" },
                                    React.createElement('span', { className: "bg-deep-green text-white w-8 h-8 rounded-full flex items-center justify-center text-sm" }, "2"),
                                    "Tracking Your Time"
                                ),
                                React.createElement('div', { className: "ml-10 space-y-3 text-gray-700" },
                                    React.createElement('p', { className: "leading-relaxed" }, "Once your projects are set up, tracking time is simple:"),
                                    React.createElement('ol', { className: "list-decimal ml-6 space-y-2" },
                                        React.createElement('li', null, "Navigate to ", React.createElement('strong', null, "View → Track Time"), " or click the ", React.createElement('strong', null, "\"Track Time\""), " toggle"),
                                        React.createElement('li', null, "Select your project from the dropdown menu"),
                                        React.createElement('li', null, "Optionally add a comment describing what you're working on"),
                                        React.createElement('li', null, "Click ", React.createElement('strong', { className: "text-deep-green" }, "\"Start Timer\""), " to begin tracking"),
                                        React.createElement('li', null, "When you're done, click ", React.createElement('strong', { className: "text-eggplant" }, "\"Stop Timer\""), " to save the entry")
                                    ),
                                    React.createElement('div', { className: "bg-pearl p-4 rounded-subtle mt-4" },
                                        React.createElement('p', { className: "font-semibold text-eggplant mb-2" }, "⚡ Power Features:"),
                                        React.createElement('ul', { className: "list-disc ml-6 space-y-1" },
                                            React.createElement('li', null, React.createElement('strong', null, "Recent Projects:"), " Your last 5 projects appear at the top for quick access"),
                                            React.createElement('li', null, React.createElement('strong', null, "Quick Switch:"), " Use the dropdown in the running timer bar to switch projects without stopping"),
                                            React.createElement('li', null, React.createElement('strong', null, "Always Visible Timer:"), " The compact timer bar stays visible on both pages")
                                        )
                                    )
                                )
                            ),

                            React.createElement('section', null,
                                React.createElement('h3', { className: "text-xl font-semibold text-deep-green mb-4 flex items-center gap-2" },
                                    React.createElement('span', { className: "bg-deep-green text-white w-8 h-8 rounded-full flex items-center justify-center text-sm" }, "3"),
                                    "Keyboard Shortcuts"
                                ),
                                React.createElement('div', { className: "ml-10 space-y-3 text-gray-700" },
                                    React.createElement('p', { className: "leading-relaxed mb-3" }, "Work faster with these global hotkeys (work even when app is minimized):"),
                                    React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                                        React.createElement('div', { className: "flex items-center gap-3 bg-soft-gray p-3 rounded-subtle" },
                                            React.createElement('kbd', { className: "px-3 py-2 bg-white border-2 border-gray-300 rounded font-mono text-sm" }, "Ctrl+Shift+Z"),
                                            React.createElement('span', null, "Show/Hide window")
                                        ),
                                        React.createElement('div', { className: "flex items-center gap-3 bg-soft-gray p-3 rounded-subtle" },
                                            React.createElement('kbd', { className: "px-3 py-2 bg-white border-2 border-gray-300 rounded font-mono text-sm" }, "Ctrl+Shift+Space"),
                                            React.createElement('span', null, "Start/Stop timer")
                                        ),
                                        React.createElement('div', { className: "flex items-center gap-3 bg-soft-gray p-3 rounded-subtle" },
                                            React.createElement('kbd', { className: "px-3 py-2 bg-white border-2 border-gray-300 rounded font-mono text-sm" }, "Ctrl+,"),
                                            React.createElement('span', null, "Open Settings")
                                        ),
                                        React.createElement('div', { className: "flex items-center gap-3 bg-soft-gray p-3 rounded-subtle" },
                                            React.createElement('kbd', { className: "px-3 py-2 bg-white border-2 border-gray-300 rounded font-mono text-sm" }, "Ctrl+H"),
                                            React.createElement('span', null, "Hide to tray")
                                        )
                                    )
                                )
                            ),

                            React.createElement('section', null,
                                React.createElement('h3', { className: "text-xl font-semibold text-deep-green mb-4 flex items-center gap-2" },
                                    React.createElement('span', { className: "bg-deep-green text-white w-8 h-8 rounded-full flex items-center justify-center text-sm" }, "4"),
                                    "Configuring Settings"
                                ),
                                React.createElement('div', { className: "ml-10 space-y-3 text-gray-700" },
                                    React.createElement('p', { className: "leading-relaxed mb-3" }, "Access ", React.createElement('strong', null, "Settings → All Settings"), " from the menu to configure:"),
                                    React.createElement('div', { className: "space-y-3" },
                                        React.createElement('div', null,
                                            React.createElement('h4', { className: "font-semibold text-eggplant mb-1" }, "⏱️ Time Rounding"),
                                            React.createElement('p', null, "Automatically round up your time entries to 5, 10, or 15-minute intervals for cleaner billing. Perfect for hourly billing requirements.")
                                        ),
                                        React.createElement('div', null,
                                            React.createElement('h4', { className: "font-semibold text-eggplant mb-1" }, "⏸️ Auto-Pause Detection"),
                                            React.createElement('p', null, "ThymeSheet monitors mouse, keyboard, and click activity. If you're idle for your chosen duration (5-30 minutes), it asks if you want to stop the timer. Prevents accidental over-billing.")
                                        ),
                                        React.createElement('div', null,
                                            React.createElement('h4', { className: "font-semibold text-eggplant mb-1" }, "🎯 Daily Goal"),
                                            React.createElement('p', null, "Set a target number of hours per day. ThymeSheet shows a live progress bar with your current hours, percentage complete, and hours remaining. Motivating and informative!")
                                        )
                                    )
                                )
                            ),

                            React.createElement('section', null,
                                React.createElement('h3', { className: "text-xl font-semibold text-deep-green mb-4 flex items-center gap-2" },
                                    React.createElement('span', { className: "bg-deep-green text-white w-8 h-8 rounded-full flex items-center justify-center text-sm" }, "5"),
                                    "Exporting Your Data"
                                ),
                                React.createElement('div', { className: "ml-10 space-y-3 text-gray-700" },
                                    React.createElement('p', { className: "leading-relaxed" }, "ThymeSheet provides flexible export options for your timesheet data:"),
                                    React.createElement('div', { className: "space-y-3" },
                                        React.createElement('div', null,
                                            React.createElement('h4', { className: "font-semibold text-eggplant mb-1" }, "📊 CSV Export"),
                                            React.createElement('p', null, "Exports a detailed CSV with both a project summary and detailed entries. Filter by date range, client, or project before exporting.")
                                        ),
                                        React.createElement('div', null,
                                            React.createElement('h4', { className: "font-semibold text-eggplant mb-1" }, "💼 QuickBooks Online (QBO) Export"),
                                            React.createElement('p', null, "Exports in QBO-compatible format for easy import into QuickBooks. Includes service items, quantities, and customer mapping.")
                                        )
                                    ),
                                    React.createElement('div', { className: "bg-deep-green bg-opacity-10 border-l-4 border-deep-green p-4 rounded-subtle mt-4" },
                                        React.createElement('p', { className: "font-semibold text-deep-green mb-2" }, "📝 Pro Tip:"),
                                        React.createElement('p', null, "Use the date range filters to export specific billing periods. Comments are included in CSV exports, so add context to your time entries!")
                                    )
                                )
                            ),

                            React.createElement('section', null,
                                React.createElement('h3', { className: "text-xl font-semibold text-deep-green mb-4 flex items-center gap-2" },
                                    React.createElement('span', { className: "bg-deep-green text-white w-8 h-8 rounded-full flex items-center justify-center text-sm" }, "6"),
                                    "System Tray Integration"
                                ),
                                React.createElement('div', { className: "ml-10 space-y-3 text-gray-700" },
                                    React.createElement('p', { className: "leading-relaxed" }, "ThymeSheet lives in your system tray for always-available access:"),
                                    React.createElement('ul', { className: "list-disc ml-6 space-y-2" },
                                        React.createElement('li', null, React.createElement('strong', null, "Double-click the tray icon"), " to show/hide the window"),
                                        React.createElement('li', null, React.createElement('strong', null, "Right-click the tray icon"), " for quick actions:"),
                                        React.createElement('ul', { className: "list-circle ml-6 mt-1" },
                                            React.createElement('li', null, "Show ThymeSheet"),
                                            React.createElement('li', null, "Start/Stop Timer"),
                                            React.createElement('li', null, "Quit")
                                        ),
                                        React.createElement('li', null, "The app stays running in the tray even when you close the window, so you can quickly pop it back up with ", React.createElement('kbd', { className: "px-2 py-1 bg-soft-gray rounded text-sm" }, "Ctrl+Shift+Z"))
                                    )
                                )
                            ),

                            React.createElement('section', { className: "border-t border-soft-gray pt-6" },
                                React.createElement('h3', { className: "text-xl font-semibold text-eggplant mb-4" }, "💡 Best Practices"),
                                React.createElement('div', { className: "space-y-2 text-gray-700" },
                                    React.createElement('ul', { className: "list-disc ml-6 space-y-2" },
                                        React.createElement('li', null, React.createElement('strong', null, "Set up all your projects at the start"), " to avoid interruptions during actual work"),
                                        React.createElement('li', null, React.createElement('strong', null, "Use descriptive comments"), " - your future self will thank you when reviewing entries"),
                                        React.createElement('li', null, React.createElement('strong', null, "Enable auto-pause"), " to prevent accidentally leaving the timer running"),
                                        React.createElement('li', null, React.createElement('strong', null, "Set a daily goal"), " to stay motivated and aware of your workload"),
                                        React.createElement('li', null, React.createElement('strong', null, "Export regularly"), " - weekly or bi-weekly exports make billing and invoicing smoother"),
                                        React.createElement('li', null, React.createElement('strong', null, "Use the Recent Projects"), " feature for recurring work - it saves valuable clicks!")
                                    )
                                )
                            )
                        ),

                        React.createElement('div', { className: "mt-8 text-center" },
                            React.createElement('button', {
                                onClick: () => setShowGuideModal(false),
                                className: "px-8 py-3 bg-deep-green text-white rounded-subtle hover:bg-opacity-90 transition-all font-semibold"
                            }, "Got It!")
                        )
                    )
                ),

                showFeedbackModal && React.createElement('div', {
                    className: "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",
                    onClick: () => setShowFeedbackModal(false)
                },
                    React.createElement('div', {
                        className: "bg-white rounded-subtle p-8 max-w-lg w-full mx-4",
                        onClick: (e) => e.stopPropagation()
                    },
                        React.createElement('div', { className: "flex justify-between items-center mb-6" },
                            React.createElement('h2', { className: "text-2xl font-bold text-deep-green" }, "Send Feedback"),
                            React.createElement('button', {
                                onClick: () => setShowFeedbackModal(false),
                                className: "text-gray-400 hover:text-deep-green text-2xl"
                            }, "×")
                        ),
                        React.createElement('div', { className: "space-y-4" },
                            React.createElement('div', null,
                                React.createElement('label', { className: "block text-sm font-semibold text-gray-700 mb-2" }, "What type of feedback?"),
                                React.createElement('select', {
                                    value: feedbackType,
                                    onChange: (e) => setFeedbackType(e.target.value),
                                    className: "w-full px-4 py-2 border border-soft-gray rounded-subtle focus:outline-none focus:border-deep-green"
                                },
                                    React.createElement('option', { value: "suggestion" }, "💡 Suggestion"),
                                    React.createElement('option', { value: "bug" }, "🐛 Bug Report"),
                                    React.createElement('option', { value: "feature" }, "✨ Feature Request"),
                                    React.createElement('option', { value: "other" }, "💬 Other")
                                )
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { className: "block text-sm font-semibold text-gray-700 mb-2" }, "Your feedback"),
                                React.createElement('textarea', {
                                    value: feedbackText,
                                    onChange: (e) => setFeedbackText(e.target.value),
                                    placeholder: "Tell us what you think...",
                                    rows: 6,
                                    className: "w-full px-4 py-2 border border-soft-gray rounded-subtle focus:outline-none focus:border-deep-green resize-none"
                                })
                            ),
                            React.createElement('div', { className: "flex justify-end gap-3 pt-4" },
                                React.createElement('button', {
                                    onClick: () => setShowFeedbackModal(false),
                                    className: "px-6 py-2 border border-soft-gray text-gray-700 rounded-subtle hover:bg-soft-gray transition-colors"
                                }, "Cancel"),
                                React.createElement('button', {
                                    onClick: () => {
                                        if (feedbackText.trim()) {
                                            const feedbackUrl = `https://docs.google.com/forms/d/e/1FAIpQLSeNFOTEUzh4y2cSDU9ndxzLFH066hQZRSZQOoGCSynuTuLI4w/viewform?usp=pp_url&entry.560510887=${encodeURIComponent(feedbackType)}&entry.1928926751=${encodeURIComponent(feedbackText)}`;
                                            require('electron').shell.openExternal(feedbackUrl);
                                            setFeedbackText('');
                                            setShowFeedbackModal(false);
                                            setActiveNotification({ type: 'success', message: 'Thank you for your feedback!' });
                                        }
                                    },
                                    disabled: !feedbackText.trim(),
                                    className: "px-6 py-2 bg-deep-green text-white rounded-subtle hover:bg-opacity-90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                                }, "Send Feedback")
                            )
                        )
                    )
                ),

                storageError && React.createElement('div', { className: "mb-8 p-5 bg-white border-l-4 border-eggplant rounded-subtle shadow-sm" },
                    React.createElement('span', { className: "text-eggplant" }, storageError),
                    React.createElement('button', {
                        onClick: () => setStorageError(null),
                        className: "ml-3 text-eggplant hover:opacity-60 transition-opacity"
                    }, "×")
                ),

                dailyGoalEnabled && dailyProgressEnabled && (() => {
                    const todaysHours = getTodaysTotalHours();
                    const progressPercent = Math.min((todaysHours / dailyGoalHours) * 100, 100);
                    const hoursRemaining = Math.max(0, dailyGoalHours - todaysHours);

                    return React.createElement('div', { className: "bg-white border-l-4 border-eggplant rounded-subtle p-6 mb-10 shadow-sm" },
                        React.createElement('div', { className: "flex justify-between items-center mb-3" },
                            React.createElement('h3', { className: "text-sm font-semibold text-eggplant uppercase tracking-wider" }, "Daily Progress"),
                            React.createElement('div', { className: "text-right" },
                                React.createElement('span', { className: "text-2xl font-semibold text-deep-green" }, todaysHours.toFixed(1)),
                                React.createElement('span', { className: "text-gray-600 text-sm" }, " / " + dailyGoalHours + "h")
                            )
                        ),
                        React.createElement('div', { className: "w-full bg-soft-gray rounded-full h-4 overflow-hidden" },
                            React.createElement('div', {
                                className: "h-full bg-gradient-to-r from-deep-green to-eggplant transition-all duration-500",
                                style: { width: progressPercent + "%" }
                            })
                        ),
                        React.createElement('div', { className: "flex justify-between items-center mt-2 text-xs text-gray-600" },
                            React.createElement('span', null, progressPercent.toFixed(0) + "% complete"),
                            React.createElement('span', null, hoursRemaining.toFixed(1) + "h remaining")
                        )
                    );
                })(),

                // Time Summary Widget
                timeSummaryEnabled && React.createElement('div', { className: "bg-white border-l-4 border-deep-green rounded-subtle shadow-sm mb-8" },
                    React.createElement('div', {
                        className: "flex justify-between items-center p-4 cursor-pointer hover:bg-off-white transition-colors",
                        onClick: () => setTimeSummaryExpanded(!timeSummaryExpanded)
                    },
                        React.createElement('h3', { className: "text-sm font-semibold text-eggplant uppercase tracking-wider" }, "Time Summary"),
                        React.createElement('div', {
                            className: "transform transition-transform " + (timeSummaryExpanded ? "" : "rotate-180")
                        }, React.createElement(ChevronDown))
                    ),
                    timeSummaryExpanded && React.createElement('div', { className: "px-4 pb-4 border-t border-soft-gray pt-4" },
                        // Summary stats
                        React.createElement('div', { className: "grid grid-cols-3 gap-4 mb-6" },
                            React.createElement('div', { className: "text-center" },
                                React.createElement('div', { className: "text-xs text-gray-600 mb-1" }, "Today"),
                                React.createElement('div', { className: "text-2xl font-bold font-mono text-deep-green tabular-nums" },
                                    getTodaysTotalHours().toFixed(1)
                                ),
                                React.createElement('div', { className: "text-xs text-gray-500 mt-1" }, "hours")
                            ),
                            React.createElement('div', { className: "text-center border-l border-r border-soft-gray" },
                                React.createElement('div', { className: "text-xs text-gray-600 mb-1" }, "This Week"),
                                React.createElement('div', { className: "text-2xl font-bold font-mono text-deep-green tabular-nums" },
                                    getThisWeeksTotalHours().toFixed(1)
                                ),
                                React.createElement('div', { className: "text-xs text-gray-500 mt-1" }, "hours")
                            ),
                            React.createElement('div', { className: "text-center" },
                                React.createElement('div', { className: "text-xs text-gray-600 mb-1" }, "This Month"),
                                React.createElement('div', { className: "text-2xl font-bold font-mono text-deep-green tabular-nums" },
                                    getThisMonthsTotalHours().toFixed(1)
                                ),
                                React.createElement('div', { className: "text-xs text-gray-500 mt-1" }, "hours")
                            )
                        ),

                        // Period filter buttons
                        React.createElement('div', { className: "flex justify-center gap-2 mb-6" },
                            React.createElement('button', {
                                onClick: () => setChartPeriod('day'),
                                className: "px-4 py-2 rounded-subtle text-sm font-medium transition-colors " + (chartPeriod === 'day' ? "bg-deep-green text-white" : "bg-soft-gray text-gray-700 hover:bg-gray-300")
                            }, "Day"),
                            React.createElement('button', {
                                onClick: () => setChartPeriod('week'),
                                className: "px-4 py-2 rounded-subtle text-sm font-medium transition-colors " + (chartPeriod === 'week' ? "bg-deep-green text-white" : "bg-soft-gray text-gray-700 hover:bg-gray-300")
                            }, "Week"),
                            React.createElement('button', {
                                onClick: () => setChartPeriod('month'),
                                className: "px-4 py-2 rounded-subtle text-sm font-medium transition-colors " + (chartPeriod === 'month' ? "bg-deep-green text-white" : "bg-soft-gray text-gray-700 hover:bg-gray-300")
                            }, "Month")
                        ),

                        // Charts container
                        React.createElement('div', { className: "grid grid-cols-1 lg:grid-cols-2 gap-6" },
                            // Column chart - Total Hours
                            React.createElement('div', { className: "bg-off-white p-4 rounded-subtle" },
                                React.createElement('h4', { className: "text-sm font-semibold text-gray-700 mb-2 text-center" }, "Total Hours"),
                                React.createElement('p', { className: "text-xs text-gray-500 mb-4 text-center" }, getChartTitle()),
                                React.createElement('div', { className: "relative h-64" },
                                    React.createElement('div', { className: "flex items-end justify-around h-full gap-2 px-2" },
                                        getChartData().map((data, index) => {
                                            const chartData = getChartData();
                                            const maxHours = Math.max(...chartData.map(d => d.hours), 1);
                                            // Calculate height as percentage of container, with minimum 8% for visibility
                                            const heightPercent = data.hours > 0 ? Math.max((data.hours / maxHours) * 100, 8) : 0;
                                            return React.createElement('div', {
                                                key: index,
                                                className: "flex flex-col items-center justify-end flex-1 max-w-[80px] h-full"
                                            },
                                                React.createElement('div', {
                                                    className: "w-full bg-deep-green rounded-t relative flex flex-col items-center justify-end pb-2 transition-all hover:bg-opacity-80",
                                                    style: { height: heightPercent + '%' }
                                                },
                                                    data.hours > 0 && React.createElement('span', { className: "text-xs text-white font-bold" }, data.hours.toFixed(1))
                                                ),
                                                React.createElement('div', { className: "text-xs text-gray-600 mt-2 text-center font-medium" }, data.label)
                                            );
                                        })
                                    )
                                )
                            ),

                            // Pie chart - Hours by Project
                            React.createElement('div', { className: "bg-off-white p-4 rounded-subtle" },
                                React.createElement('h4', { className: "text-sm font-semibold text-gray-700 mb-2 text-center" }, "Hours by Project"),
                                React.createElement('p', { className: "text-xs text-gray-500 mb-4 text-center" }, getChartTitle()),
                                getProjectChartData().length > 0 ? React.createElement('div', { className: "flex flex-col items-center" },
                                    // Actual pie chart
                                    React.createElement('svg', { width: "200", height: "200", viewBox: "0 0 200 200", className: "mb-4" },
                                        (() => {
                                            const projectData = getProjectChartData();
                                            const colors = ['#4A7C59', '#6B9375', '#8CAA91', '#ADC1AD', '#CED8C9', '#4A7C59', '#6B9375', '#8CAA91'];
                                            let currentAngle = 0;

                                            return projectData.map((data, index) => {
                                                const percentage = parseFloat(data.percentage);
                                                const angle = (percentage / 100) * 360;
                                                const startAngle = currentAngle;
                                                const endAngle = currentAngle + angle;
                                                currentAngle = endAngle;

                                                const startRadians = (startAngle - 90) * (Math.PI / 180);
                                                const endRadians = (endAngle - 90) * (Math.PI / 180);
                                                const largeArc = angle > 180 ? 1 : 0;

                                                const x1 = 100 + 90 * Math.cos(startRadians);
                                                const y1 = 100 + 90 * Math.sin(startRadians);
                                                const x2 = 100 + 90 * Math.cos(endRadians);
                                                const y2 = 100 + 90 * Math.sin(endRadians);

                                                const pathData = `M 100 100 L ${x1} ${y1} A 90 90 0 ${largeArc} 1 ${x2} ${y2} Z`;

                                                return React.createElement('path', {
                                                    key: index,
                                                    d: pathData,
                                                    fill: colors[index % colors.length],
                                                    stroke: '#fff',
                                                    strokeWidth: '2'
                                                });
                                            });
                                        })()
                                    ),
                                    // Legend
                                    React.createElement('div', { className: "w-full space-y-2" },
                                        getProjectChartData().map((data, index) => {
                                            const colors = ['#4A7C59', '#6B9375', '#8CAA91', '#ADC1AD', '#CED8C9', '#4A7C59', '#6B9375', '#8CAA91'];
                                            const color = colors[index % colors.length];
                                            return React.createElement('div', { key: index, className: "flex items-center gap-2 text-sm" },
                                                React.createElement('div', {
                                                    className: "w-3 h-3 rounded-full flex-shrink-0",
                                                    style: { backgroundColor: color }
                                                }),
                                                React.createElement('span', { className: "text-gray-700 truncate flex-1" }, data.project),
                                                React.createElement('span', { className: "text-deep-green font-bold whitespace-nowrap" }, data.hours.toFixed(1) + 'h'),
                                                React.createElement('span', { className: "text-gray-500 text-xs whitespace-nowrap" }, '(' + data.percentage + '%)')
                                            );
                                        })
                                    )
                                ) : React.createElement('div', { className: "h-56 flex items-center justify-center text-gray-500 text-sm" }, "No data available")
                            )
                        )
                    )
                ),

                recentProjects.length > 0 && React.createElement('div', { className: "bg-white border-l-4 border-deep-green rounded-subtle p-6 mb-8 shadow-sm" },
                    React.createElement('div', { className: "flex items-center justify-between mb-4" },
                        React.createElement('h3', { className: "text-sm font-semibold text-eggplant uppercase tracking-wider" }, "Recent Projects"),
                        React.createElement('div', { className: "text-xs text-gray-600 bg-soft-gray px-3 py-1 rounded-subtle" },
                            "Press ",
                            React.createElement('kbd', { className: "px-1.5 py-0.5 bg-white border border-gray-300 rounded text-xs font-mono mx-1" }, "1-5"),
                            " then ",
                            React.createElement('kbd', { className: "px-1.5 py-0.5 bg-white border border-gray-300 rounded text-xs font-mono mx-1" }, "Enter"),
                            " to start"
                        )
                    ),
                    React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-3" },
                        recentProjects.slice(0, 9).map((projectId, index) => {
                            const project = projectCodes.find(p => p.id === projectId);
                            if (!project) return null;
                            const isActive = isTracking && currentSession && currentSession.projectId === projectId;
                            const isSelected = selectedProject === projectId.toString();

                            return React.createElement('button', {
                                key: projectId,
                                onClick: () => {
                                    if (isTracking && !isActive) {
                                        switchProject(projectId);
                                    } else {
                                        setSelectedProject(projectId.toString());
                                    }
                                },
                                className: "relative p-3 rounded-subtle border-2 transition-all text-left " +
                                    (isActive ? "border-deep-green bg-deep-green bg-opacity-10" :
                                     isSelected ? "border-eggplant bg-eggplant bg-opacity-10" :
                                     "border-soft-gray bg-white hover:border-deep-green")
                            },
                                React.createElement('div', { className: "absolute top-1 right-1 w-5 h-5 bg-deep-green text-white text-xs font-bold rounded-full flex items-center justify-center" }, (index + 1).toString()),
                                React.createElement('div', { className: "text-xs font-semibold text-deep-green truncate" }, project.code),
                                React.createElement('div', { className: "text-xs text-gray-600 truncate" }, project.clientName),
                                React.createElement('div', { className: "text-xs text-gray-500 truncate" }, project.subtaskCode),
                                isActive && React.createElement('div', { className: "text-xs text-deep-green font-semibold mt-1" }, "● TRACKING")
                            );
                        })
                    )
                ),

                React.createElement('div', { className: "bg-white border-l-4 border-eggplant rounded-subtle p-6 mb-8 shadow-sm" },
                    React.createElement('h2', { className: "text-lg font-semibold text-eggplant mb-4" }, "Track Time"),
                    React.createElement('div', { className: "grid grid-cols-1 lg:grid-cols-3 gap-4" },
                        React.createElement('div', { className: "lg:col-span-2" },
                            React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-3 mb-3" },
                                React.createElement('div', null,
                                    React.createElement('label', { className: "block text-xs font-medium text-gray-700 mb-1" }, "1. Select Client"),
                                    React.createElement('select', {
                                        value: selectedClient,
                                        onChange: (e) => handleClientChange(e.target.value),
                                        className: "w-full px-3 py-2 text-sm border border-soft-gray rounded-subtle focus:outline-none focus:border-eggplant bg-white text-gray-800",
                                        disabled: isTracking
                                    },
                                        React.createElement('option', { value: "" }, "Choose client..."),
                                        getAvailableClients().map(client =>
                                            React.createElement('option', { key: client, value: client }, client)
                                        )
                                    )
                                ),
                                React.createElement('div', null,
                                    React.createElement('label', { className: "block text-xs font-medium text-gray-700 mb-1" }, "2. Select Project"),
                                    React.createElement('select', {
                                        value: selectedProjectName,
                                        onChange: (e) => handleProjectNameChange(e.target.value),
                                        className: "w-full px-3 py-2 text-sm border border-soft-gray rounded-subtle focus:outline-none focus:border-eggplant bg-white text-gray-800",
                                        disabled: !selectedClient || isTracking
                                    },
                                        React.createElement('option', { value: "" }, "Choose project..."),
                                        getAvailableProjectNames(selectedClient).map(project =>
                                            React.createElement('option', { key: project, value: project }, project)
                                        )
                                    )
                                ),
                                React.createElement('div', null,
                                    React.createElement('label', { className: "block text-xs font-medium text-gray-700 mb-1" }, "3. Select Task"),
                                    React.createElement('select', {
                                        value: selectedTaskCode,
                                        onChange: (e) => handleTaskCodeChange(e.target.value),
                                        className: "w-full px-3 py-2 text-sm border border-soft-gray rounded-subtle focus:outline-none focus:border-eggplant bg-white text-gray-800",
                                        disabled: !selectedProjectName || isTracking
                                    },
                                        React.createElement('option', { value: "" }, "Choose task..."),
                                        getAvailableTaskCodes(selectedClient, selectedProjectName).map(task =>
                                            React.createElement('option', { key: task, value: task }, task)
                                        )
                                    )
                                ),
                                React.createElement('div', null,
                                    React.createElement('label', { className: "block text-xs font-medium text-gray-700 mb-1" }, "4. Select Subtask"),
                                    React.createElement('select', {
                                        value: selectedProject,
                                        onChange: (e) => {
                                            if (isTracking) {
                                                switchProject(parseInt(e.target.value));
                                            } else {
                                                handleSubtaskCodeChange(e.target.value);
                                            }
                                        },
                                        className: "w-full px-3 py-2 text-sm border border-soft-gray rounded-subtle focus:outline-none focus:border-eggplant bg-white text-gray-800",
                                        disabled: !selectedTaskCode
                                    },
                                        React.createElement('option', { value: "" }, "Choose subtask..."),
                                        getAvailableSubtaskCodes(selectedClient, selectedProjectName, selectedTaskCode).map(subtask =>
                                            React.createElement('option', { key: subtask.id, value: subtask.id }, subtask.subtaskCode + " (" + subtask.code + ")")
                                        )
                                    )
                                )
                            ),
                            React.createElement('div', { className: "mt-3" },
                                React.createElement('label', { className: "block text-xs font-medium text-gray-700 mb-1" }, "Comment (Optional)"),
                                React.createElement('textarea', {
                                    value: currentComment,
                                    onChange: (e) => setCurrentComment(e.target.value),
                                    placeholder: "Add notes about this time entry...",
                                    className: "w-full px-3 py-2 text-sm border border-soft-gray rounded-subtle focus:outline-none focus:border-eggplant bg-white text-gray-800 resize-none",
                                    rows: 2
                                })
                            )
                        ),
                        React.createElement('div', { className: "flex flex-col justify-center items-center bg-pearl rounded-subtle p-4" },
                            React.createElement('div', { className: "text-center mb-3" },
                                React.createElement('div', { className: "text-xs text-gray-600 mb-1" }, "Elapsed Time"),
                                React.createElement('div', { className: "text-3xl font-mono font-bold text-deep-green tabular-nums" }, formatTime(elapsedTime))
                            ),
                            React.createElement('div', { className: "w-full" },
                                !isTracking ?
                                    React.createElement('button', {
                                        onClick: startTracking,
                                        disabled: !selectedProject,
                                        className: "w-full px-5 py-2.5 bg-deep-green text-white rounded-subtle hover:bg-opacity-90 transition-all font-semibold text-sm disabled:bg-gray-400 disabled:cursor-not-allowed"
                                    }, "Start Timer") :
                                    React.createElement('button', {
                                        onClick: stopTracking,
                                        className: "w-full px-5 py-2.5 bg-eggplant text-white rounded-subtle hover:bg-opacity-90 transition-all font-semibold text-sm"
                                    }, "Stop Timer")
                            )
                        )
                    )
                ),

                React.createElement('div', { className: "bg-white border-l-4 border-deep-green rounded-subtle p-6 mb-8 shadow-sm" },
                    React.createElement('h3', { className: "text-lg font-semibold text-eggplant mb-4" }, "Export Options"),
                    React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-4 mb-4" },
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-2" }, "Start Date"),
                            React.createElement('input', {
                                type: "date",
                                value: filterStartDate,
                                onChange: (e) => setFilterStartDate(e.target.value),
                                className: "w-full px-3 py-2 border border-soft-gray rounded-subtle focus:outline-none focus:border-eggplant"
                            })
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-2" }, "End Date"),
                            React.createElement('input', {
                                type: "date",
                                value: filterEndDate,
                                onChange: (e) => setFilterEndDate(e.target.value),
                                className: "w-full px-3 py-2 border border-soft-gray rounded-subtle focus:outline-none focus:border-eggplant"
                            })
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-2" }, "Filter by Client"),
                            React.createElement('select', {
                                value: filterClient,
                                onChange: (e) => setFilterClient(e.target.value),
                                className: "w-full px-3 py-2 border border-soft-gray rounded-subtle focus:outline-none focus:border-eggplant"
                            },
                                React.createElement('option', { value: "" }, "All Clients"),
                                getUniqueClients().map(client =>
                                    React.createElement('option', { key: client, value: client }, client)
                                )
                            )
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-2" }, "Filter by Project"),
                            React.createElement('select', {
                                value: filterProject,
                                onChange: (e) => setFilterProject(e.target.value),
                                className: "w-full px-3 py-2 border border-soft-gray rounded-subtle focus:outline-none focus:border-eggplant"
                            },
                                React.createElement('option', { value: "" }, "All Projects"),
                                getUniqueProjects().map(project =>
                                    React.createElement('option', { key: project, value: project }, project)
                                )
                            )
                        )
                    ),
                    React.createElement('button', {
                        onClick: exportToExcel,
                        disabled: timeEntries.length === 0,
                        className: "w-full flex items-center justify-center gap-2 px-6 py-3 bg-deep-green text-white rounded-subtle hover:bg-opacity-90 transition-all font-medium disabled:bg-gray-400 disabled:cursor-not-allowed"
                    },
                        React.createElement(Download),
                        "Export to Excel"
                    )
                ),

                React.createElement('div', { className: "bg-white border-l-4 border-eggplant rounded-subtle p-6 shadow-sm" },
                    React.createElement('h3', { className: "text-lg font-semibold text-eggplant mb-4" }, "Recent Entries"),
                    timeEntries.length === 0 ?
                        React.createElement('div', { className: "text-center py-8 text-gray-500" },
                            React.createElement('p', null, "No time entries yet. Start tracking to see your entries here!")
                        ) :
                        React.createElement('div', null,
                            React.createElement('div', { className: "mb-4" },
                                React.createElement('input', {
                                    type: "text",
                                    value: timeEntriesSearchTerm,
                                    onChange: (e) => {
                                        setTimeEntriesSearchTerm(e.target.value);
                                        setCurrentPage(1);
                                    },
                                    placeholder: "Search by client, project, or comment...",
                                    className: "w-full px-4 py-2 border border-soft-gray rounded-subtle focus:outline-none focus:border-deep-green"
                                })
                            ),
                            React.createElement('div', { className: "overflow-x-auto" },
                                React.createElement('table', { className: "w-full text-sm" },
                                    React.createElement('thead', null,
                                        React.createElement('tr', { className: "border-b border-soft-gray" },
                                            React.createElement('th', { className: "text-left py-3 px-2 font-semibold text-gray-700" }, "Date"),
                                            React.createElement('th', { className: "text-left py-3 px-2 font-semibold text-gray-700" }, "Code"),
                                            React.createElement('th', { className: "text-left py-3 px-2 font-semibold text-gray-700" }, "Client"),
                                            React.createElement('th', { className: "text-left py-3 px-2 font-semibold text-gray-700" }, "Project"),
                                            React.createElement('th', { className: "text-left py-3 px-2 font-semibold text-gray-700" }, "Start"),
                                            React.createElement('th', { className: "text-left py-3 px-2 font-semibold text-gray-700" }, "End"),
                                            React.createElement('th', { className: "text-left py-3 px-2 font-semibold text-gray-700" }, "Hours"),
                                            React.createElement('th', { className: "text-left py-3 px-2 font-semibold text-gray-700" }, "Comment"),
                                            React.createElement('th', { className: "text-left py-3 px-2 font-semibold text-gray-700" }, "Actions")
                                        )
                                    ),
                                    React.createElement('tbody', null,
                                        (() => {
                                            const entriesPerPage = 10;
                                            const reversedEntries = timeEntries.slice().reverse();

                                            // Filter entries based on search term
                                            const filteredEntries = timeEntriesSearchTerm.trim() === ''
                                                ? reversedEntries
                                                : reversedEntries.filter(entry => {
                                                    const searchLower = timeEntriesSearchTerm.toLowerCase();
                                                    return (
                                                        (entry.clientName && entry.clientName.toLowerCase().includes(searchLower)) ||
                                                        (entry.projectName && entry.projectName.toLowerCase().includes(searchLower)) ||
                                                        (entry.comment && entry.comment.toLowerCase().includes(searchLower)) ||
                                                        (entry.projectCode && entry.projectCode.toLowerCase().includes(searchLower))
                                                    );
                                                });

                                            const totalPages = Math.ceil(filteredEntries.length / entriesPerPage);
                                            const startIndex = (currentPage - 1) * entriesPerPage;
                                            const endIndex = startIndex + entriesPerPage;
                                            const currentEntries = filteredEntries.slice(startIndex, endIndex);

                                            return currentEntries.map((entry) =>
                                                React.createElement('tr', { key: entry.id, className: "border-b border-soft-gray hover:bg-off-white transition-colors" },
                                                    React.createElement('td', { className: "py-3 px-2" }, entry.date),
                                                    React.createElement('td', { className: "py-3 px-2 font-semibold text-deep-green" }, entry.projectCode),
                                                    React.createElement('td', { className: "py-3 px-2 text-gray-700" }, entry.clientName),
                                                    React.createElement('td', { className: "py-3 px-2 text-gray-700" }, entry.projectName),
                                                    React.createElement('td', { className: "py-3 px-2 text-gray-600" }, entry.startTime),
                                                    React.createElement('td', { className: "py-3 px-2 text-gray-600" }, entry.endTime),
                                                    React.createElement('td', { className: "py-3 px-2 font-semibold" }, entry.hours.toFixed(2)),
                                                    React.createElement('td', { className: "py-3 px-2 text-gray-600 text-xs max-w-xs truncate" }, entry.comment || '-'),
                                                    React.createElement('td', { className: "py-3 px-2" },
                                                        React.createElement('div', { className: "flex items-center gap-2" },
                                                            React.createElement('button', {
                                                                onClick: () => startEditEntry(entry),
                                                                className: "text-gray-400 hover:text-deep-green transition-colors",
                                                                title: "Edit entry"
                                                            }, React.createElement(Edit2)),
                                                            React.createElement('button', {
                                                                onClick: () => deleteEntry(entry.id),
                                                                className: "text-gray-400 hover:text-eggplant transition-colors",
                                                                title: "Delete entry"
                                                            }, React.createElement(Trash2))
                                                        )
                                                    )
                                                )
                                            );
                                        })()
                                    )
                                )
                            ),
                            // Pagination controls
                            (() => {
                                const entriesPerPage = 10;
                                const reversedEntries = timeEntries.slice().reverse();

                                // Filter entries based on search term (same logic as above)
                                const filteredEntries = timeEntriesSearchTerm.trim() === ''
                                    ? reversedEntries
                                    : reversedEntries.filter(entry => {
                                        const searchLower = timeEntriesSearchTerm.toLowerCase();
                                        return (
                                            (entry.clientName && entry.clientName.toLowerCase().includes(searchLower)) ||
                                            (entry.projectName && entry.projectName.toLowerCase().includes(searchLower)) ||
                                            (entry.comment && entry.comment.toLowerCase().includes(searchLower)) ||
                                            (entry.projectCode && entry.projectCode.toLowerCase().includes(searchLower))
                                        );
                                    });

                                const totalPages = Math.ceil(filteredEntries.length / entriesPerPage);

                                if (totalPages <= 1) return null;

                                const getPageNumbers = () => {
                                    const pages = [];
                                    const maxVisible = 10;

                                    if (totalPages <= maxVisible) {
                                        // Show all pages
                                        for (let i = 1; i <= totalPages; i++) {
                                            pages.push(i);
                                        }
                                    } else {
                                        // Show first 10 pages and ellipsis
                                        for (let i = 1; i <= Math.min(maxVisible, totalPages); i++) {
                                            pages.push(i);
                                        }
                                        if (totalPages > maxVisible) {
                                            pages.push('...');
                                        }
                                    }

                                    return pages;
                                };

                                return React.createElement('div', { className: "flex items-center justify-center gap-2 mt-4 flex-wrap" },
                                    // Previous button
                                    React.createElement('button', {
                                        onClick: () => setCurrentPage(Math.max(1, currentPage - 1)),
                                        disabled: currentPage === 1,
                                        className: "px-3 py-1 rounded-subtle border border-soft-gray hover:border-deep-green disabled:opacity-30 disabled:cursor-not-allowed transition-colors"
                                    }, "← Prev"),

                                    // Page numbers
                                    getPageNumbers().map((page, index) => {
                                        if (page === '...') {
                                            return React.createElement('span', { key: `ellipsis-${index}`, className: "px-2 text-gray-400" }, '...');
                                        }

                                        return React.createElement('button', {
                                            key: page,
                                            onClick: () => setCurrentPage(page),
                                            className: currentPage === page
                                                ? "px-3 py-1 rounded-subtle bg-deep-green text-white font-semibold"
                                                : "px-3 py-1 rounded-subtle border border-soft-gray hover:border-deep-green transition-colors"
                                        }, page);
                                    }),

                                    // Next button
                                    React.createElement('button', {
                                        onClick: () => setCurrentPage(Math.min(totalPages, currentPage + 1)),
                                        disabled: currentPage === totalPages,
                                        className: "px-3 py-1 rounded-subtle border border-soft-gray hover:border-deep-green disabled:opacity-30 disabled:cursor-not-allowed transition-colors"
                                    }, "Next →")
                                );
                            })()
                        )
                ),
                // Notification Toast
                activeNotification && React.createElement('div', {
                    className: "fixed bottom-4 right-4 z-50"
                },
                    React.createElement('div', {
                        className: "bg-white border-l-4 rounded-subtle shadow-xl p-4 max-w-sm flex items-start gap-3 " + (activeNotification.type === 'success' ? "border-deep-green" : "border-eggplant")
                    },
                        React.createElement('div', { className: "flex-1" },
                            React.createElement('p', { className: "text-sm text-gray-800" }, activeNotification.message)
                        ),
                        React.createElement('button', {
                            onClick: () => setActiveNotification(null),
                            className: "text-gray-400 hover:text-gray-600 transition-colors text-xl leading-none"
                        }, "×")
                    )
                ),
                // Edit Entry Modal
                editingEntry && React.createElement('div', {
                    className: "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",
                    onClick: cancelEditEntry
                },
                    React.createElement('div', {
                        className: "bg-white rounded-subtle shadow-xl p-4 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",
                        onClick: (e) => e.stopPropagation()
                    },
                        React.createElement('h3', { className: "text-base font-semibold text-eggplant mb-3" }, "Edit Time Entry"),
                        React.createElement('div', { className: "space-y-3" },
                            React.createElement('div', { className: "bg-soft-gray p-3 rounded-subtle space-y-2" },
                                React.createElement('h4', { className: "text-xs font-semibold text-eggplant mb-1" }, "Project Selection"),
                                React.createElement('div', { className: "grid grid-cols-2 gap-2" },
                                React.createElement('div', null,
                                    React.createElement('label', { className: "block text-xs font-semibold text-gray-700 mb-1" }, "1. Client Name"),
                                    React.createElement('select', {
                                        value: (() => {
                                            const project = projectCodes.find(p => p.id === editFormData.projectId);
                                            return project ? project.clientName : '';
                                        })(),
                                        onChange: (e) => {
                                            const clientName = e.target.value;
                                            if (clientName) {
                                                // Find first project for this client
                                                const firstProject = projectCodes.find(p => p.clientName === clientName);
                                                if (firstProject) {
                                                    setEditFormData({ ...editFormData, projectId: firstProject.id });
                                                }
                                            }
                                        },
                                        className: "w-full px-2 py-1.5 text-sm border border-soft-gray rounded-subtle focus:outline-none focus:border-deep-green bg-white"
                                    },
                                        React.createElement('option', { value: '' }, "Select client..."),
                                        [...new Set(projectCodes.map(p => p.clientName))].sort().map(client =>
                                            React.createElement('option', { key: client, value: client }, client)
                                        )
                                    )
                                ),
                                (() => {
                                    const currentProject = projectCodes.find(p => p.id === editFormData.projectId);
                                    if (!currentProject) return null;

                                    const availableProjects = projectCodes.filter(p => p.clientName === currentProject.clientName);
                                    const uniqueProjectNames = [...new Set(availableProjects.map(p => p.projectName))];

                                    return React.createElement('div', null,
                                        React.createElement('label', { className: "block text-xs font-semibold text-gray-700 mb-1" }, "2. Project/Admin Name"),
                                        React.createElement('select', {
                                            value: currentProject.projectName,
                                            onChange: (e) => {
                                                const projectName = e.target.value;
                                                const firstMatch = projectCodes.find(p =>
                                                    p.clientName === currentProject.clientName &&
                                                    p.projectName === projectName
                                                );
                                                if (firstMatch) {
                                                    setEditFormData({ ...editFormData, projectId: firstMatch.id });
                                                }
                                            },
                                            className: "w-full px-2 py-1.5 text-sm border border-soft-gray rounded-subtle focus:outline-none focus:border-deep-green bg-white"
                                        },
                                            uniqueProjectNames.map(projName =>
                                                React.createElement('option', { key: projName, value: projName }, projName)
                                            )
                                        )
                                    );
                                })(),
                                (() => {
                                    const currentProject = projectCodes.find(p => p.id === editFormData.projectId);
                                    if (!currentProject) return null;

                                    const availableTasks = projectCodes.filter(p =>
                                        p.clientName === currentProject.clientName &&
                                        p.projectName === currentProject.projectName
                                    );
                                    const uniqueTasks = [...new Set(availableTasks.map(p => p.taskCode))];

                                    return React.createElement('div', null,
                                        React.createElement('label', { className: "block text-xs font-semibold text-gray-700 mb-1" }, "3. Task"),
                                        React.createElement('select', {
                                            value: currentProject.taskCode,
                                            onChange: (e) => {
                                                const taskCode = e.target.value;
                                                const firstMatch = projectCodes.find(p =>
                                                    p.clientName === currentProject.clientName &&
                                                    p.projectName === currentProject.projectName &&
                                                    p.taskCode === taskCode
                                                );
                                                if (firstMatch) {
                                                    setEditFormData({ ...editFormData, projectId: firstMatch.id });
                                                }
                                            },
                                            className: "w-full px-2 py-1.5 text-sm border border-soft-gray rounded-subtle focus:outline-none focus:border-deep-green bg-white"
                                        },
                                            uniqueTasks.map(task =>
                                                React.createElement('option', { key: task, value: task }, task)
                                            )
                                        )
                                    );
                                })(),
                                (() => {
                                    const currentProject = projectCodes.find(p => p.id === editFormData.projectId);
                                    if (!currentProject) return null;

                                    const availableSubtasks = projectCodes.filter(p =>
                                        p.clientName === currentProject.clientName &&
                                        p.projectName === currentProject.projectName &&
                                        p.taskCode === currentProject.taskCode
                                    );

                                    return React.createElement('div', null,
                                        React.createElement('label', { className: "block text-xs font-semibold text-gray-700 mb-1" }, "4. Subtask"),
                                        React.createElement('select', {
                                            value: editFormData.projectId,
                                            onChange: (e) => {
                                                setEditFormData({ ...editFormData, projectId: Number(e.target.value) });
                                            },
                                            className: "w-full px-2 py-1.5 text-sm border border-soft-gray rounded-subtle focus:outline-none focus:border-deep-green bg-white"
                                        },
                                            availableSubtasks.map(proj =>
                                                React.createElement('option', { key: proj.id, value: proj.id },
                                                    proj.subtaskCode + ' (' + proj.code + ')'
                                                )
                                            )
                                        )
                                    );
                                })()
                                )
                            ),
                            React.createElement('div', { className: "grid grid-cols-2 gap-2" },
                            React.createElement('div', null,
                                React.createElement('label', { className: "block text-xs font-semibold text-gray-700 mb-1" }, "Date"),
                                React.createElement('input', {
                                    type: "date",
                                    value: editFormData.date || '',
                                    onChange: (e) => setEditFormData({ ...editFormData, date: e.target.value }),
                                    className: "w-full px-2 py-1.5 text-sm border border-soft-gray rounded-subtle focus:outline-none focus:border-deep-green"
                                })
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { className: "block text-xs font-semibold text-gray-700 mb-1" }, "Start Time"),
                                React.createElement('input', {
                                    type: "time",
                                    step: "1",
                                    value: editFormData.startTime || '',
                                    onChange: (e) => setEditFormData({ ...editFormData, startTime: e.target.value }),
                                    className: "w-full px-2 py-1.5 text-sm border border-soft-gray rounded-subtle focus:outline-none focus:border-deep-green"
                                })
                            )
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { className: "block text-xs font-semibold text-gray-700 mb-1" }, "End Time"),
                                React.createElement('div', { className: "space-y-1.5" },
                                    React.createElement('input', {
                                        type: "time",
                                        step: "1",
                                        value: editFormData.endTime || '',
                                        onChange: (e) => setEditFormData({ ...editFormData, endTime: e.target.value }),
                                        className: "w-full px-2 py-1.5 text-sm border border-soft-gray rounded-subtle focus:outline-none focus:border-deep-green"
                                    }),
                                    editFormData.startTime && React.createElement('div', {
                                        className: "border border-soft-gray rounded p-1.5 max-h-32 overflow-y-auto bg-white"
                                    },
                                        React.createElement('div', { className: "grid grid-cols-6 gap-1.5" },
                                            (() => {
                                                // Generate preset time options in 15-minute increments up to 8 hours
                                                const parseTime = (timeStr) => {
                                                    const [hours, minutes, seconds] = timeStr.split(':').map(Number);
                                                    return (hours * 60 + minutes) + (seconds || 0) / 60;
                                                };

                                                const formatMinutesToTime = (totalMinutes) => {
                                                    const hours = Math.floor(totalMinutes / 60);
                                                    const minutes = Math.floor(totalMinutes % 60);
                                                    const seconds = Math.floor(((totalMinutes % 60) - minutes) * 60);
                                                    return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                                                };

                                                const formatDuration = (minutes) => {
                                                    if (minutes < 60) return minutes + ' min';
                                                    const hours = minutes / 60;
                                                    if (Number.isInteger(hours)) return hours + ' hour' + (hours !== 1 ? 's' : '');
                                                    return hours.toFixed(2) + ' hours';
                                                };

                                                const startMinutes = parseTime(editFormData.startTime);

                                                // Generate all 15-minute increments from 15 minutes to 8 hours (480 minutes)
                                                const presets = [];
                                                for (let i = 15; i <= 480; i += 15) {
                                                    presets.push(i);
                                                }

                                                return presets.map(duration => {
                                                    const endMinutes = startMinutes + duration;
                                                    const endTime = formatMinutesToTime(endMinutes);
                                                    const isSelected = editFormData.endTime === endTime;

                                                    return React.createElement('button', {
                                                        key: duration,
                                                        type: 'button',
                                                        onClick: () => setEditFormData({ ...editFormData, endTime: endTime }),
                                                        className: "px-1.5 py-1 text-xs border rounded transition-all whitespace-nowrap " + (isSelected
                                                            ? "bg-deep-green text-white border-deep-green font-semibold"
                                                            : "border-soft-gray hover:border-deep-green hover:bg-soft-gray")
                                                    }, formatDuration(duration));
                                                });
                                            })()
                                        )
                                    )
                                )
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { className: "block text-xs font-semibold text-gray-700 mb-1" }, "Comment"),
                                React.createElement('input', {
                                    type: "text",
                                    value: editFormData.comment || '',
                                    onChange: (e) => setEditFormData({ ...editFormData, comment: e.target.value }),
                                    placeholder: "Add comment (optional)...",
                                    className: "w-full px-2 py-1.5 text-sm border border-soft-gray rounded-subtle focus:outline-none focus:border-deep-green"
                                })
                            )
                        ),
                        React.createElement('div', { className: "flex items-center justify-end gap-2 mt-3 pt-3 border-t border-soft-gray" },
                            React.createElement('button', {
                                onClick: cancelEditEntry,
                                className: "px-3 py-1.5 text-sm border border-soft-gray rounded-subtle hover:border-gray-400 transition-colors"
                            }, "Cancel"),
                            React.createElement('button', {
                                onClick: saveEditEntry,
                                className: "px-3 py-1.5 text-sm bg-deep-green text-white rounded-subtle hover:bg-opacity-90 transition-colors"
                            }, "Save Changes")
                        )
                    )
                )
                )
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(TimeTracker));
    </script>
</body>
</html>
